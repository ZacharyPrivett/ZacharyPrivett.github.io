YUI.add("stacking-overlay-manager",function(e,i){var n=require("hermes-core/flog")(i);e.StackingOverlayManager=function(i){var s,o,r=[],t={},a={push:function(n,a){var l,d,c=Object.assign({id:e.guid(),view:void 0,overlayClassList:"",hideOverlay:!1,dismissOnOverlayClick:!0,dismissOnEsc:!0,ignorePointerEvents:!1,disableBodyScroll:!0,popBeforePushOther:!1},n),v=e.one("#stacking-overlay-container"),h=this.findFirstPopBeforePushOverlay();return h&&this.pop(h.id),v.setStyles({display:"block"}),r.push(c),(l=e.Node.create('<div class="fluid-modal-overlay"><div class="balls"></div></div>')).addClass("fluid-modal-overlay"),c.overlayClassList&&l.addClass(c.overlayClassList),c.hideOverlay&&l.addClass("transparent"),c.ignorePointerEvents&&l.addClass("invisible"),v.append(l),d=l.on("click",this.handleClick.bind(this)),t[c.id]={overlay:c,node:l,clickHandler:d},c.disableBodyScroll&&e.one("body").setStyles({overflow:"hidden"}),s||(s=e.one("body").on("keyup",this.handleKeyPress.bind(this))),o||(o=i.flapp.on("activeViewChange",this.handleActiveViewChange.bind(this))),c.id},pop:function(i){var n=this;if(i){var t=r.length-1;r.find(function(e,n){return t=n,e.id===i})&&r.slice(t,r.length).reverse().forEach(function(i,s){i.isPopped||(i.isPopped=!0,n.closeView(i),n.findFirstDisableBodyScrollOverlay()===i&&e.one("body").setStyles({overflow:"visible"}),r.pop(),n.deleteOverlay(i))})}r.length<=0&&(e.one("#stacking-overlay-container").setStyles({display:"none"}),s&&(s.detach(),s=void 0),o&&(o.detach(),o=void 0))},deleteOverlay:function(e){var i=t[e.id];i&&(i.clickHandler.detach(),i.node.remove(),delete t[e.id])},handleClick:function(e){var i=e.target,n=r.find(function(e){return t[e.id].node===i});n.dismissOnOverlayClick&&this.pop(n.id)},handleKeyPress:function(e){if(27===e.keyCode){var i=this.findLastDismissOnEscOverlay();i&&this.pop(i.id)}},placeViewAfterOverlay:function(e){var i=t[e];i&&i.overlay.view&&i.node.insert(i.overlay.view.get("container"),"after")},findLastDismissOnEscOverlay:function(){return r.slice().reverse().find(function(e){return e.dismissOnEsc})},findFirstDisableBodyScrollOverlay:function(){return r.find(function(e){return e.disableBodyScroll})},findFirstPopBeforePushOverlay:function(){return r.find(function(e){return e.popBeforePushOther})},closeView:function(e){e&&e.view&&(e.view.close?e.view.close():(n.warn("The overlay associated with the view "+e.view.name+" was popped, but the view has no close function. Consider implementing one."),e.view.destroy({remove:!0})))},handleActiveViewChange:function(e){this.popAll()},popAll:function(){var e=r.length>0?r[0]:void 0;e&&this.pop(e.id)},hasOverlay:function(){return r.length>0}};return e.augment(a,e.EventTarget),a}},"@VERSION@",{requires:["event-custom"],langBundles:["common"]});YUI.add("app-context",function(e,i){var t,o=require("hermes-core/flog")(i),n=require("hermes-core/fletrics"),r=YUI.Env.isServer?e.config.flickr.api.server_default_timeout:e.config.flickr.api.client_default_timeout,s=YUI.Env.isServer?e.config.flickr.api.server_retry_timeout:e.config.flickr.api.client_retry_timeout,a=[117,118,119],l=new RegExp(e.config.flickr.api.write_api_method_regex),c=e.config.flickr.model_eviction,h={};(t=e.AppContext=function(i){(i=i||{}).request&&(this.request=i.request),this.params={},this._initializeParams(i),this.viewTiming={},this.modelRegistries={},this.modelImportExport=new e.ModelImportExport(this),this.flickrAPI=new e.FlickrAPI(this.request,this),this.auth=i.auth,this.flapp=i.flapp,this.writeAPICallsMadeOnThisPage={},this._moduleInstances={},this._pendingYUIPromises={},this._loadedViews={},this._apiCalls={},this._previousLocation=null,this._uploadInProgress=!1,this._pendingUploadErrorModal=null,this._concurrentAPICalls=0,this._apiQueueOrder=[],this._apiQueueFunctions={},this._preliminaryNsid=null,this.flipper=new e.Flipper(i.flipper),this.experiments={fullscreen:new e.Experiments.Fullscreen(this),optOut:new e.Experiments.OptOut(this)},this.secure="https"===this.protocol,this.adManager=new e.AdManager(this.params.referrer,this),this.allowThirdPartyContent=!0,this.cookieCatcher=new e.CookieCatcher(this,{required:e.config.flickr.cookie_consent.cookie_level_buckets.required,functional:e.config.flickr.cookie_consent.cookie_level_buckets.functional,advertising:e.config.flickr.cookie_consent.cookie_level_buckets.advertising}),this.requiresCookieConsent=!0,this.flipper.isFlipped("enable-cookie-consent-execution-hermes")&&(YUI.Env.isServer?(this.flipper.isFlipped("enable-geoblock-cookie-consent")&&!this.request.requiresCookieConsent&&(this.requiresCookieConsent=!1),this.cookieConsentContext=this.request.cookie_consent_context):(this.cookieConsentContext=this.cookieCatcher.getCookieConsentContext(),this.flipper.isFlipped("enable-geoblock-cookie-consent")&&!this.cookieConsentContext.needsConsent&&(this.requiresCookieConsent=!1)),this.flipper.isFlipped("enable-geoblock-cookie-consent")?this.requiresCookieConsent&&(this.allowThirdPartyContent=e.config.flickr.cookie_consent.third_party_level_consent<=this.cookieConsentContext.info.cookieBlock.level):this.allowThirdPartyContent=e.config.flickr.cookie_consent.third_party_level_consent<=this.cookieConsentContext.info.cookieBlock.level),this.audienceTargets=new e.Audience(this,i.audienceTargets),this.viewportData=new e.ViewportData(this),this.clientId="f"+Math.round(1e4*Math.random()).toString(36),this.isCSSLoaded=!1,this.bannerManager=new e.BannerHelper(this),YUI.Env.isServer||(this.overlayManager=new e.StackingOverlayManager(this)),this.initGlobalEvictionExemptionConfig()}).getValidParams=function(){return["bucket","protocol","buckets","slice","random_slice","referrer","flipper","lang","gp_code","gp_owner","share_code"]},t.prototype={routeConfig:{},_initializeParams:function(e){var i=this;t.getValidParams().forEach(function(t){e.request&&t in e.request&&(e[t]=e.request[t]),t in e&&(i[t]=e[t],i.params[t]=e[t])})},promisedUse:function(i){var t=YUI.Env.isServer,o=t?this.request.app.yui:e;return new e.Promise(function(e,n){o.use(i,function(i,o){t?e(i):o&&"success"in o?o.success?e(i):n(o.msg):n("Y.use: no status provided")})})},instantiateYUIModule:function(i,t){if(!e.Lang.isString(i)||!e.Lang.isFunction(t))return e.Promise.reject("[app-context] `instantiateYUIModule` called without a `name` or `initializer`.");var o=this._moduleInstances,n=this._pendingYUIPromises;return n[i]||(o[i]?n[i]=e.Promise.resolve(o[i]):n[i]=this.promisedUse(i).then(function(){var e=t();return o[i]=e,delete n[i],e})),n[i]},getModelRegistry:function(i){if(!e.Lang.isString(i))return e.Promise.reject("[app-context] `getModelRegistry` called without a `name`.");var t,r=this;return this.instantiateYUIModule(i,function(s){if(!e.Models||!e.Models[i]||"function"!=typeof e.Models[i])throw o.error("There was an error loading the modelregistry",{status:s}),n.increment("appContext.getmodelregistry.failures"),t=new Error("[app-context] - Model registry failed to load:"+i),t.moduleLoadingError=!0,t;var a=new e.Models[i](r);return r.modelRegistries[i]=a,a})},getModel:function(i,t,o){return e.Lang.isString(i)?t?this.getModelRegistry(i).then(function(i){return this._refetchExistingModels&&(e.Lang.isObject(t,!0)?i.attributeSearch(t):[t]).forEach(function(e){this.canEvictModel(i,e)&&this.evictModel(i,e)}.bind(this)),i.get(t,o)}.bind(this)):e.Promise.reject("[app-context] `getModel` ("+i+") called without `modelIdOrAttributes`."):e.Promise.reject("[app-context] `getModel` called without a `registryName`.")},markAsNewlyFetched:function(e,i){this._refetchExistingModels&&(this._refetchedModels[e]||(this._refetchedModels[e]={}),this._refetchedModels[e][i]=!0)},getRoute:function(i){var t,r=this;return this.instantiateYUIModule(i,function(s){if(!e.Routes||!e.Routes[i]||"function"!=typeof e.Routes[i])throw o.error("There was an error loading the route",{status:s}),n.increment("appContext.getroute.failures"),t=new Error("[app-context] - Route failed to load:"+i),t.moduleLoadingError=!0,t;return new e.Routes[i](r)})},getView:function(i,t,r){var s,a=this;return t=t||{},t.appContext=a,a.promisedUse(i).then(function(r){if(!e.Views||!e.Views[i]||"function"!=typeof e.Views[i])throw o.error("There was an error loading the view",{status:r}),n.increment("appContext.getview.failures"),s=new Error("[app-context] - View failed to load:"+i),s.moduleLoadingError=!0,s;return a._loadedViews[i]=!0,new e.Views[i](t)})},getLoadedViews:function(){return Object.keys(this._loadedViews)},setGPCredentials:function(e){null===e?(delete this.params.gp_owner,delete this.params.gp_code,delete this.params.share_code,delete h.gp_owner,delete h.gp_code,delete h.share_code,o.info("Setting GP credentials to null")):null!==e&&e.gp_code&&(this.params.gp_owner=e.gp_owner,this.params.gp_code=e.gp_code,this.params.share_code=e.share_code,h.gp_owner=e.gp_owner,h.gp_code=e.gp_code,h.share_code=e.share_code,o.info("Setting GP credentials to "+e.share_code))},getCookie:function(i){return YUI.Env.isServer?this.request.cookies[escape(i)]:e.Cookie.get(i)},setCookie:function(i){if(YUI.Env.isServer)o.warn("You can't set a cookie from the server with AppContext -- use middleware.",i);else{i.cookieName&&void 0!==i.cookieValue&&i.path||o.error("Missing important parameters to set a cookie");var t=i.cookieName,n=i.cookieValue,r=i.domain||".flickr.com",s=i.path,a=i.expiresMonthsFromNow||3,l=i.expires?i.expires:e.moment().add(a,"months").toDate();i.remove&&e.Cookie.remove(t,{domain:i.domain||".flickr.com",path:s}),this.cookieCatcher.setCookieIfAllowed(t,n,{domain:r,path:s,expires:l})}},removeCookie:function(i){YUI.Env.isServer?o.warn("You can't remove a cookie from the server with AppContext -- use middleware.",i):(i.cookieName&&i.path||o.error("Missing important parameters to remove a cookie"),e.Cookie.remove(i.cookieName,{domain:i.domain||".flickr.com",path:i.path}))},reissueCookie:function(e,i){var t;e&&i||o.error("Missing important parameters to reissue a cookie"),t=this.getCookie(e),this.setCookie({cookieName:e,path:i,cookieValue:t})},getViewer:function(){var e={},i=this;return e.getPixelRatio=function(){var e;return(e=YUI.Env.isServer?i.getCookie("density"):window.devicePixelRatio)||(e=1),e},this.auth&&this.auth.signedIn?(e.nsid=this.auth.user.nsid,e.intl=this.auth.intl,e.signedIn=this.auth.signedIn,e.isInsecureGod=this.auth.isInsecureGod,e.isMinor=this.auth.isMinor,e.isPro=this.auth.user.ispro,e.isCognitoUser=this.auth.isCognitoUser,e.prefs={timezonePref:this.auth.timezonePref,downloadAccessPref:this.auth.downloadAccessPref}):this._preliminaryNsid?(e.nsid=this._preliminaryNsid,e.signedIn=!0):(e.signedIn=!1,e.prefs={timezonePref:{name:"",dst:!1,offset:"+00:00",isDefaults:!0}}),YUI.Env.isServer?e.userAdBlockEnabled=null:e.userAdBlockEnabled=this.adManager.getAdBlockStatus(),e},setPreliminaryViewerNsid:function(e){this._preliminaryNsid=e},getKeyboardManager:function(){return this._keyboardManager||(this._keyboardManager=new e.KeyboardManager),this._keyboardManager},initGlobalEvictionExemptionConfig:function(){var e=this.getViewer().nsid;this._globalEvictionExemptionConfig={},e&&(this._globalEvictionExemptionConfig["person-preferences-models"]={exemptIds:[e]})},getPreviousURL:function(){var e="";return this._previousLocation&&(e=this._previousLocation.pathname,this._previousLocation.querystring&&(e+="?"+this._previousLocation.querystring),this._previousLocation.hash&&(e+="#"+this._previousLocation.hash)),e},getPreviousLocation:function(){return e.merge(this._previousLocation)},setPreviousLocation:function(){this._previousLocation=this.getLocation()},updateModelRefetchState:function(i,t){if(!this.flipper.isFlipped("evict-models-on-navigate")||!i||t)return this._refetchExistingModels=!1,void(this._refetchedModels=null);var o,n;this._previousLocation&&(o=e.URLHelper.getSiteSectionByURL(this._previousLocation.pathname)),i&&(i="/"+i.split("/").slice(3).join("/"),n=e.URLHelper.getSiteSectionByURL(i)),this._refetchExistingModels=void 0,n&&c.entry_refetch_exemptions[n.name]&&(this._refetchExistingModels=!1),o&&c.exit_refetch_exemptions[o.name]&&(this._refetchExistingModels=!1),void 0===this._refetchExistingModels&&n&&o&&(c.transition_refetch_exemptions[o.name]&&c.transition_refetch_exemptions[o.name][n.name]?this._refetchExistingModels=!1:this._refetchExistingModels=o.name!==n.name),void 0===this._refetchExistingModels&&(this._refetchExistingModels=!1),this._refetchedModels={}},hasClientSideRouted:function(){return!!this._clientSideRouted},setClientSideRouted:function(e){this._clientSideRouted=e},getReferrer:function(){var e;try{e=this.flapp.get("activeView").getViewDataFromHistory("referrer")}catch(e){}return e},getLocation:function(){var i;return YUI.Env.isServer?(i={protocol:this.request.protocol,hostname:this.request.hostname,pathname:this.request.path,query:this.request.query,querystring:this.request.query?e.QueryString.stringify(this.request.query):"",hash:""}).href=i.protocol+"://"+i.hostname+this.request.originalUrl:(i={protocol:e.config.win.location.protocol.split(":")[0],hostname:e.config.win.location.hostname,pathname:e.config.win.location.pathname,querystring:e.config.win.location.search.split("?")[1],href:e.config.win.location.href,hash:e.config.win.location.hash}).query=i.querystring?e.QueryString.parse(i.querystring):"",i},getViewCounter:function(){return this._viewCounter||(this._viewCounter=new e.ViewCounter({appContext:this})),this._viewCounter},getBucket:function(e){if(this.buckets)return this.buckets[e]},handleMismatchedNSID:function(){var i,t;i=e.mix({langBundles:["common"],appContext:this},e.Localizable),(t=new e.Views.FluidModal({title:i.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),textMessage:i.intlMessage({intlName:"common.MISMATCHED_NSID_ERROR"}),appContext:this,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(i){e.config.win.location.reload(!0)}),t.show()},mitigateClientPanda:function(i){var t,o;return t=e.mix({langBundles:["common"],appContext:this},e.Localizable),(o=new e.Views.FluidModal({title:t.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:t.intlMessage({intlName:"common.OK"}),htmlMessage:t.intlMessage({intlName:i}),appContext:this,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(i){e.config.win.location.reload(!0)}),o.show(),e.PromiseChainDestroyer()},callAPI:function(i,t,n,c){var u,d,p,f=this,g=[i,t=t||{},null,c];return n=n&&!YUI.Env.isServer,g=null!==h?[i,e.merge(t,h),null,c]:[i,t,null,c],u=i+"__"+Object.keys(t).sort().map(function(e){return encodeURIComponent(e)+"_"+encodeURIComponent(t[e])}).join("__"),this._apiCalls[u]?(e.config.flickr.cameraroll.suppress_logging&&"flickr.cameraroll.getPhotosByOffset"===i||o.log("Reusing API call",{method:i}),f._apiQueueOrder.length>1&&(p=f._apiQueueOrder.indexOf(u))>-1&&p<f._apiQueueOrder.length-1&&(f._apiQueueOrder.splice(p,1),f._apiQueueOrder.push(u)),this._apiCalls[u].then(function(i){return e.clone(i,!0)},function(i){throw e.clone(i,!0)})):(n&&(g.push(null),g.push({timeout:r})),i.match(l)&&this.cacheWriteAPICall(u,i),this._apiCalls[u]=new e.Promise(function(t,r){var l;l=function(){f.flickrAPI.callMethod.apply(f.flickrAPI,g).then(function(e){return f.onAPICallComplete(u,!0),e},function(t){if(f.onAPICallComplete(u,!1),!YUI.Env.isServer&&-1!==a.indexOf(t.code))return f.handleMismatchedNSID(),e.PromiseChainDestroyer();if(!YUI.Env.isServer&&0===t.status&&0===t.total)return f.mitigateClientPanda("common.NETWORK_CONNECTIVITY_ISSUE");if(n&&(t.clientTimeout||0===t.status||t.transportFailure)){if(o.log("Retrying API call",{method:i}),delete f._apiCalls[u],!YUI.Env.isServer&&e.config.win.beaconError){if(e.config.win.document)try{t.domain=e.config.win.document.domain}catch(e){}e.config.win.beaconError("[app-context] Retrying API ",e.config.win.location.href,t)}return(d=g[g.length-1]).timeout&&(d.timeout=s),f._apiCalls[u]=f.flickrAPI.callMethod.apply(f.flickrAPI,g).then(function(t){return f.onAPICallComplete(u,!0),o.log("Successfully retried API call",{method:i}),e.fire("appContext:apiRetry",{apiMethod:i,code:418}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("[app-context] Successful API retry ",e.config.win.location.href,{}),t},function(t){throw f.onAPICallComplete(u,!1),o.log("Failed retry of API call",{method:i}),e.fire("appContext:apiRetry",{apiMethod:i,code:408}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("[app-context] Failed API retry ",e.config.win.location.href,{}),t}),f._concurrentAPICalls++,f._apiCalls[u]}throw t}).then(t,r)},YUI.Env.isServer?l():(f._apiQueueOrder.push(u),f._apiQueueFunctions[u]=l,f.callNextInQueue())}),this._apiCalls[u])},callNextInQueue:function(){var i,t,o=e.config.flickr.api.max_concurrent_api_calls;this._apiQueueOrder.length&&this._concurrentAPICalls<o&&(this._concurrentAPICalls++,i=this._apiQueueOrder.pop(),t=this._apiQueueFunctions[i],delete this._apiQueueFunctions[i],t())},cacheWriteAPICall:function(e,i){this.writeAPICallsMadeOnThisPage[e]={methodName:i,completed:!1,failed:!1}},onAPICallComplete:function(e,i){var t=this.writeAPICallsMadeOnThisPage[e];t&&(t.completed=!0,t.failed=!i),delete this._apiCalls[e],this._concurrentAPICalls--,this.callNextInQueue()},clearWriteAPICallCache:function(){this.writeAPICallsMadeOnThisPage={}},canEvictModel:function(e,i){var t,o;return!(!e||!i)&&(!!e.exists(i)&&(t=e.name,o=this._globalEvictionExemptionConfig[t],!(o&&o.exemptIds&&-1!==o.exemptIds.indexOf(i))&&(this._refetchedModels[t]||(this._refetchedModels[t]={}),!this._refetchedModels[t][i])))},evictModel:function(e,i){var t=e.name;this.flipper.isFlipped("model-eviction-debugging")&&console.log("[EVICT] "+t+" ["+i+"]"),e.getOwnedModels(i).forEach(function(e){this.canEvictModel(e.registry,e.id)&&this.evictModel(e.registry,e.id)}.bind(this)),e.remove(i)},evictModels:function(i){var t,n,r,s,a=this.getViewer().nsid,l=[],c=this.modelRegistries;for(t in this.writeAPICallsMadeOnThisPage)(n=this.writeAPICallsMadeOnThisPage[t]).completed&&!n.failed&&l.push(n);l.forEach(function(e){}),this._refetchExistingModels&&(a&&(i=e.merge(i,this._globalEvictionExemptionConfig)),Object.keys(this.modelRegistries).forEach(function(e){r=c[e],(s=i[e])?s.exemptIds?(s.evictIds&&o.warn("Error in eviction config for registry: cannot specify both a whitelist (`evictIds`) and a blacklist (`exemptIds`) for model eviction. Ignoring `evictIds` and evicting all models except those listed in `exemptIds`.",{modelRegistryName:e}),r.removeAllExcept(s.exemptIds)):s.evictIds&&s.evictIds.forEach(function(i){c[e].remove(i)}):c[e].removeAll()}))},markUploadInProgress:function(e){this._uploadInProgress=e},uploadIsInProgress:function(){return this._uploadInProgress},storePendingUploadErrorModal:function(e){this._pendingUploadErrorModal=e},retrievePendingUploadErrorModal:function(e){return this._pendingUploadErrorModal},_doForcedServerRender:function(){if(!YUI.Env.isServer||!this.request||!this.request.headers)return!1;var e=!1;return e=e||this.request.UA.isBot,e=e||this.request.UA.isSharingBot,this.flipper.isFlipped("enable-server-render-for-unsupported-browsers")&&(e=e||this.request.UA.isUnsupportedBrowser),this.flipper.isFlipped("enable-forced-server-render")&&(e=!0),e},getUA:function(){return YUI.Env.isServer?this.request.UA:e.config.flickr.request.UA},logViewTiming:function(){var e,i=this.flapp.get("activeView"),t=0,o=this;e=function(i,n){t++,Object.keys(i.subviews).forEach(function(r){var s=i.subviews[r].get("container").hasClass("requiredToShowOnServer")||i.subviews[r]._params.requiredToShowOnClient,a=n&&s,l="-";l=s?"🔹":"-",l=a?"🔷":l,console.log("| \t\t "+new Array(t).join(" |\t\t ")+" "+l+" "+r+" (initialization: "+o.viewTiming[r].initialize+"ms) (loadState: "+o.viewTiming[r].loadState+"ms)"),e(i.subviews[r],a)}),t--},console.log(this.routeConfig.module+": "+this.routeTiming+"ms"),console.log("🔷 "+i.name+" (initialization: "+this.viewTiming[i.name].initialize+"ms) (loadState: "+this.viewTiming[i.name].loadState+"ms)"),e(i,!0)}}},"@VERSION@",{requires:["oop","flickr-api","flickr-promise","promise","model-import-export","cookie","view-counter","flipper","localizable","moment","experiments-fullscreen","experiments-opt-out","moola-manager","viewport-data","querystring-parse-simple","querystring-stringify-simple","url-helper","browser-support","api-helper","banner-helper","cookie-catcher","moola-audience-targeting","stacking-overlay-manager"]});YUI.add("querystring-stringify",function(e,t){var n=e.namespace("QueryString"),r=[],i=e.Lang;n.escape=encodeURIComponent,n.stringify=function(e,t,s){var o,u,a,f,l,c,h=t&&t.sep?t.sep:"&",p=t&&t.eq?t.eq:"=",d=t&&t.arrayKey?t.arrayKey:!1;if(i.isNull(e)||i.isUndefined(e)||i.isFunction(e))return s?n.escape(s)+p:"";if(i.isBoolean(e)||Object.prototype.toString.call(e)==="[object Boolean]")e=+e;if(i.isNumber(e)||i.isString(e))return n.escape(s)+p+n.escape(e);if(i.isArray(e)){c=[],s=d?s+"[]":s,f=e.length;for(a=0;a<f;a++)c.push(n.stringify(e[a],t,s));return c.join(h)}for(a=r.length-1;a>=0;--a)if(r[a]===e)throw new Error("QueryString.stringify. Cyclical reference");r.push(e),c=[],o=s?s+"[":"",u=s?"]":"";for(a in e)e.hasOwnProperty(a)&&(l=o+a+u,c.push(n.stringify(e[a],t,l)));return r.pop(),c=c.join(h),!c&&s?s+"=":c}},"3.16.0",{requires:["yui-base"]});
YUI.add("better-cache",function(e){function c(e,c){return e.score<c.score?-1:e.score>c.score?1:0}function t(){var e,t,o;for(r.sort(c),u={},r.length>n&&(o=r.shift()).callback&&o.callback(),e=r.length,t=0;t<e;t++)u[r[t].key]=t}var n,r=[],o=0,u={};n=e.config.flickr.better_cache_size||100,e.betterCache={reset:function(){r=[],o=0,u={}},_cache:r,getSize:function(){return r.length},unset:function(e){var c=u[e];void 0!==c&&(r.splice(c,1),t())},set:function(e,c,n){var a;!1!==c?((a=!!u[e]&&r[u[e]])?(r[u[e]].value=c,r[u[e]].score=o++,"function"==typeof n&&(a.callback=n)):(a={key:e,value:c,score:o++},"function"==typeof n&&(a.callback=n),r.push(a)),t()):this.unset(e)},get:function(e){return"number"==typeof u[e]?(r[u[e]].score=++o,r[u[e]].value):null}}},"@VERSION@");YUI.add("datatype-xml-parse",function(e,t){e.mix(e.namespace("XML"),{parse:function(t){var n=null,r;return typeof t=="string"&&(r=e.config.win,r.ActiveXObject!==undefined?(n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(t)):r.DOMParser!==undefined?n=(new DOMParser).parseFromString(t,"text/xml"):r.Windows!==undefined&&(n=new Windows.Data.Xml.Dom.XmlDocument,n.loadXml(t))),n===null||n.documentElement===null||n.documentElement.nodeName==="parsererror",n}}),e.namespace("Parsers").xml=e.XML.parse,e.namespace("DataType"),e.DataType.XML=e.XML},"3.16.0");
YUI.add("io-xdr",function(e,t){function a(e,t,n){var r='<object id="io_swf" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0">'+'<param name="movie" value="'+e+'">'+'<param name="FlashVars" value="yid='+t+"&uid="+n+'">'+'<param name="allowScriptAccess" value="always">'+"</object>",i=s.createElement("div");s.body.appendChild(i),i.innerHTML=r}function f(t,n,r){return n==="flash"&&(t.c.responseText=decodeURI(t.c.responseText)),r==="xml"&&(t.c.responseXML=e.DataType.XML.parse(t.c.responseText)),t}function l(e,t){return e.c.abort(e.id,t)}function c(e){return u?i[e.id]!==4:e.c.isInProgress(e.id)}var n=e.publish("io:xdrReady",{fireOnce:!0}),r={},i={},s=e.config.doc,o=e.config.win,u=o&&o.XDomainRequest;e.mix(e.IO.prototype,{_transport:{},_ieEvt:function(e,t){var n=this,r=e.id,s="timeout";e.c.onprogress=function(){i[r]=3},e.c.onload=function(){i[r]=4,n.xdrResponse("success",e,t)},e.c.onerror=function(){i[r]=4,n.xdrResponse("failure",e,t)},e.c.ontimeout=function(){i[r]=4,n.xdrResponse(s,e,t)},e.c[s]=t[s]||0},xdr:function(t,n,i){var s=this;return i.xdr.use==="flash"?(r[n.id]=i,o.setTimeout(function(){try{n.c.send(t,{id:n.id,uid:n.uid,method:i.method,data:i.data,headers:i.headers})}catch(e){s.xdrResponse("transport error",n,i),delete r[n.id]}},e.io.xdr.delay)):u?(s._ieEvt(n,i),n.c.open(i.method||"GET",t),setTimeout(function(){n.c.send(i.data)},0)):n.c.send(t,n,i),{id:n.id,abort:function(){return n.c?l(n,i):!1},isInProgress:function(){return n.c?c(n.id):!1},io:s}},xdrResponse:function(e,t,n){n=r[t.id]?r[t.id]:n;var s=this,o=u?i:r,a=n.xdr.use,l=n.xdr.dataType;switch(e){case"start":s.start(t,n);break;case"success":s.success(f(t,a,l),n),delete o[t.id];break;case"timeout":case"abort":case"transport error":t.c={status:0,statusText:e};case"failure":s.failure(f(t,a,l),n),delete o[t.id]}},_xdrReady:function(t,r){e.fire(n,t,r)},transport:function(t){t.id==="flash"&&(a(e.UA.ie?t.src+"?d="+(new Date).valueOf().toString():t.src,e.id,t.uid),e.IO.transports.flash=function(){return s.getElementById("io_swf")})}}),e.io.xdrReady=function(t,n){var r=e.io._map[n];e.io.xdr.delay=0,r._xdrReady.apply(r,[t,n])},e.io.xdrResponse=function(t,n,r){var i=e.io._map[n.uid];i.xdrResponse.apply(i,[t,n,r])},e.io.transport=function(t){var n=e.io._map["io:0"]||new e.IO;t.uid=n._uid,n.transport.apply(n,[t])},e.io.xdr={delay:100}},"3.16.0",{requires:["io-base","datatype-xml-parse"]});
YUI.add("page-title-helper",function(e){e.pageTitleHelper=function(r){var i="Flickr";return e.Lang.isString(r)&&(r=r.trim())&&(i=r+" | "+i),i}},"@VERSION@",{requires:[]});YUI.add("flickr-route",function(r,e){var t=require("hermes-core/flog")(e),a=require("hermes-core/type-validator");r.Routes=r.Routes||{},r.FlickrRoute=function(r){this.appContext=r},r.FlickrRoute.prototype={run:function(){},setRouteDataOnHistory:function(e,t){return r.HistoryHelper.setData(this.name,e,t)},getRouteDataFromHistory:function(e){return r.HistoryHelper.getData(this.name,e)},getRouteMetaValue:function(r,e){return this.appContext.routeConfig.meta?e?this.appContext.routeConfig.meta[r]?this.appContext.routeConfig.meta[r]:e:this.appContext.routeConfig.meta[r]?this.appContext.routeConfig.meta[r]:null:null},displayServerErrorOrClientRedirect:function(e,t,a){return YUI.Env.isServer?this.displayRouteErrors(e,new r.RouteError(404,t)):r.Promise.resolve({redirect:a||e.url})},detectRouteErrors:function(){return r.Array(arguments).filter(function(e,t){return e instanceof r.RouteError}).sort(function(r,e){return r.type-e.type})},displayRouteErrors:function(e,t){var a=r.Lang.isArray(t)?t[0]:t;return r.Promise.resolve(this["display"+a.type+"Error"](e,a))},display500Error:function(e,a){var i,o,s;return i={view:"error-500-page-view",params:{},headers:{statusCode:500},layout:"maximized"},(r.config.flickr.error.show_debugging_info||e.isInsecureGod||this.appContext&&this.appContext.auth&&this.appContext.auth.isInsecureGod)&&(i.params.source="flickrRoute#display500Error",i.params.message=a.message,i.params.stack=a.stack,i.params.apiMethod=a.apiMethod),YUI.Env.isServer||(i.params.message=a.message,i.params.apiMethod=a.apiMethod),e.id&&(i.params.requestID=e.id),a&&"SiteAuth"===a.type&&(a.redirect?(o=YUI.Env.isServer?e.protocol+"://"+e.hostname+e.originalUrl:e.url,s=r.url("/siteauth/?redirect_url="+encodeURIComponent(o)),YUI.Env.isServer&&t.info("Redirecting to siteauth",{production:YUI.Env.production}),i={redirect:s}):YUI.Env.isServer&&(i.params.siteAuthFailure=!0)),void 0===i.redirect?t.info("render",{status:500,req:e,err:a,isBot:this.appContext.getUA().isBot}):t.info("redirect",{status:302,req:e,location:i.redirect,isBot:this.appContext.getUA().isBot}),i},display303Error:function(r,e){return{redirect:e.options.redirect,headers:{statusCode:303}}},display403Error:function(r,e){return this.displayStandardErrorPage(r,e,403)},display404Error:function(r,e){return e=e||new Error("404"),t.info("render",{status:404,url:r.url,err:e,isBot:this.appContext.getUA().isBot}),this.displayStandardErrorPage(r,e,404)},display410Error:function(r,e){return this.displayStandardErrorPage(r,e,410)},displayStandardErrorPage:function(e,t,a){var i;return t=t||{},i={view:"fluid-error-page-view",params:{statusCode:a,url:e.url,message:t.message,catchAll:t.catchAll||!1},headers:{statusCode:a}},t.data&&(i.params=r.merge(i.params,t.data)),(r.config.flickr.error.show_debugging_info||e.isInsecureGod||this.appContext&&this.appContext.auth&&this.appContext.auth.isInsecureGod)&&(i.params.source="flickrRoute#display"+a+"Error",i.params.message=t.message),e.id&&(i.params.requestID=e.id),i},getPageNumber:function(r,e){var t=parseInt(r.params[e||"page_number"],10);return(isNaN(t)||t<=1)&&(t=1),t},getNSIDOrPathAlias:function(r){var e;return a.nsid(r)?e=r:a.pathAlias(r)?e={pathAlias:r}:t.warn("Couldn't identify "+r+" as an nsid or path alias."),e}},r.RouteError=function(r,e,t){this.type=r,this.message=e||"",this.data=t||{}}},"@VERSION@",{requires:["flickr-promise","moment","url","history-helper"]});YUI.add("site-key",function(e,t){"use strict";var i=require("hermes-core/flog")(t),r=require("hermes-core/fletrics");e.SiteKey=function(t,i){this.configurator=t||null,this.flickrAPI=i||new e.FlickrAPI,this._tasks=[]},e.SiteKey.prototype.getKey=function(){return e.config.flickr.api.site_key},e.SiteKey.prototype.isExpired=function(){return Date.now()/1e3>e.config.flickr.api.site_key_expiresAt},e.SiteKey.prototype.invalidate=function(e){var t=this._lastStored||0;if(e||(e=0),!(e<t))return this.setExpired()},e.SiteKey.prototype.setExpired=function(){return e.config.flickr.api.site_key_expiresAt=0},e.SiteKey.prototype.store=function(t,i){var r;this._lastStored=Date.now(),i||(i=Math.floor(this._lastStored/1e3)),e.config.flickr.api.site_key=t,e.config.flickr.api.site_key_fetched=i,e.config.flickr.api.site_key_expiresAt=e.config.flickr.api.site_key_fetched+e.config.flickr.api.site_key_fetch_interval,this.configurator&&((r={}).site_key=t,r.site_key_fetched=i,this.configurator.update({api:r})),this.drainQueue()},e.SiteKey.prototype.setTrustedKey=function(e){this._trustedKey=e},e.SiteKey.prototype.getTrustedKey=function(){return this._trustedKey||null},e.SiteKey.prototype.pushToQueue=function(e){this._tasks.push(e)},e.SiteKey.prototype.drainQueue=function(){for(;this._tasks.length;)this._tasks.shift().resolve()},e.SiteKey.prototype.hasQueuedTasks=function(){return!!this._tasks.length},e.SiteKey.prototype.scheduleFutureFetch=function(){this._timerFutureFetch=setTimeout(this.fetch.bind(this),1e3*e.config.flickr.api.site_key_fetch_interval)},e.SiteKey.prototype.scheduleRetry=function(t){var i=this,r=this._fetchRuns>4?1:Math.pow(2,(this._fetchRuns||1)-1)/10,s=e.config.flickr.api.site_key_retry_interval*r;clearTimeout(this._timerRetry),this._timerRetry=setTimeout(function(){i._timerRetry=null,i.fetch(t)},1e3*s)},e.SiteKey.prototype.fetch=function(t){clearTimeout(this._timerFutureFetch);var s,o=this,n=o.hasQueuedTasks();return!t&&(t=new e.Promise(function(e,t){this.resolve=e,this.reject=t}),this.pushToQueue(t),n)?t:((s=r.createStopwatch("test.site.key.api.latency")).start(),this._fetchRuns||(this._fetchRuns=0),this._fetchRuns++,this.flickrAPI.fetchSiteKey().then(function(e){var t=e.site_key;s.stop(),i.info("Received new site key",{key:t}),o._fetchRuns=0,o.store(t),r.sync(),o.scheduleFutureFetch()},function(e){r.increment("sitekey.fetch.failures"),i.error("Failed to fetch site key",{err:e}),o.scheduleRetry(t)}),t)},e.augment(e.SiteKey,e.EventTarget)},"@VERSION@",{requires:["event-custom","flickr-api","flickr-promise"]});YUI.add("hermes-lang-client-app",function(e,t){e.Intl.add("hermes/client-app","en-US",{SAVING_LAST_ACTIONS:["Hey! We’re still saving your last actions, you might lose them if you leave this page."],UPLOAD_IN_PROGRESS:["Wait! Your photos are still on the way to our servers. They might not get there if you leave this page before they arrive."]})},"@VERSION@",{requires:["intl"]});YUI.add("client-transport",function(e){"use strict";function t(e){var t;if(e.data.photo_id&&p.photos[e.data.photo_id]){for(t in p.photos[e.data.photo_id])c.unset(t);delete p.photos[e.data.photo_id]}if(e.data.user_id&&p.users[e.data.user_id]){for(t in p.users[e.data.user_id])c.unset(t);delete p.users[e.data.user_id]}}function r(t,s,o){var n,a=this;return(n=function(){var c;return a.keys.siteKey.isExpired()?(c=a.keys.siteKey.fetch(),c=c.then(n)):a.keys.csrf.isExpired()?(c=a.keys.csrf.fetch(),c=c.then(n)):o?(i.call(a,t,s,o,r),o):new e.Promise(function(e,o){this.resolve=e,this.reject=o,i.call(a,t,s,this,r)})})()}function i(r,i,n,l){var k,y,v,w,T,_,S,E,I,b,P,x=this;if(w=e.config.flickr.request?e.config.flickr.request.id:window.reqId,i=i||{},i.data=i.data||{},i.data.csrf=this.keys.csrf.getKey(),i.data.api_key=this.keys.siteKey.getKey(),!i.data.api_key){var R=new Error("Invalid API key.");return o("Invalid API key.",{}),R.fatal=!0,R.panda=!0,void n.reject(R)}if(i.method=i.method||"GET",i.data.format="json",i.data.hermes=1,i.data.hermesClient=1,i.data.reqId=w,k=r,v=k+JSON.stringify(i.data),i.data.method&&i.data.method.match(h)&&(i.method="POST",t(i)),y=c.get(v))return e.Promise.resolve(y).then(n.resolve);i.data.nojsoncallback=1,this._authRetry=this._authRetry||0,this._authRetry++,T=(new Date).getTime(),_=i.data.method,S=i.data,E={method:i.method,data:i.data,xdr:{use:"native",credentials:!0,dataType:"application/json"},on:{complete:function(h,g){var k,y,I={},R=!0===m.exclude[i.data.method],O=!1!==m.include[i.data.method],C=(new Date).getTime(),N=0;a&&(k=h,g=g.rawRequest);try{N=g.status}catch(e){}if(I.reqId=w,404===N)return n.resolve({status:404}),I.apiMethod=_,void e.fire("client-transport:apiError",I);if(503===N)return n.reject({status:503}),I.apiMethod=_,void e.fire("client-transport:apiError",I);if(0===N&&g&&4!==g.readyState)return setTimeout(function(){e.ClientTransport.unloading||((y={status:0,resp:g,message:"XHR aborted:"+g.readyState}).total=C-T,y.apiMethod=_,a&&k&&(y.message+=": "+k.message),y.total>E.timeout&&(y.timeout=!0,y.clientTimeout=!0,y.message="XHR Timeout"),n.reject(y),I.apiMethod=_,e.fire("client-transport:apiError",I))},10),void s(P,"abort",b);if(0===N){(y={status:0,resp:g,message:"XHR error"}).total=C-T,y.apiMethod=_,a&&k&&(y.message+=": "+k.message),y.total>E.timeout&&(y.timeout=!0,y.clientTimeout=!0,y.message="XHR Timeout");try{var j=new Image;j.addEventListener("error",function(){o("XHR maybe dns issue",{})},!1),j.src=e.config.flickr.api.hostname_client+"/services/spaceout.gif"}catch(e){}return n.reject(y),I.apiMethod=_,e.fire("client-transport:apiError",I),void s(P,"error",b)}try{I=JSON.parse(g.responseText)||{}}catch(t){return n.reject({status:0,message:"invalid JSON in response",resp:g}),I.apiMethod=_,void e.fire("client-transport:apiError",I)}if("ok"!==I.stat)return I.code=Number(I.code),l&&[98,99,100].indexOf(I.code)>=0&&x._authRetry<d?(98===I.code&&x.keys.csrf.invalidate(T),x.keys.siteKey.invalidate(T),void l.call(x,r,i,n)):(I.apiMethod=_,e.fire("client-transport:apiError",I),"flickr.site.getCsrf"===_?n.reject(I):n.resolve(I));e.soon(function(){e.fire("client-transport:apiTime",{start:T,end:C,method:S.method})}),x._authRetry=0,n.resolve(I),"GET"===i.method&&O&&!R&&(!(function(e,t){for(var r;r=f.exec(t);)p.photos[r[1]]||(p.photos[r[1]]={}),p.photos[r[1]][e]=e;for(;r=u.exec(t);)p.users[r[1]]||(p.users[r[1]]={}),p.users[r[1]][e]=e})(v,g.responseText),c.set(v,I),setTimeout(function(){t(i)},12e4))},start:function(){},end:function(){},failure:function(){}}};try{P=k+"?"+e.QueryString.stringify(E.data)}catch(e){}I=(new Date).getTime();var O={useXDR:!0,method:i.method,withCredentials:"true"};if(a&&("POST"===i.method?(O.url=k,O.body=e.QueryString.stringify(E.data),O.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}):O.url=P),"complete"!==window.document.readyState){var C=window.document.onreadystatechange;window.document.onreadystatechange=function(){"complete"===window.document.readyState&&(C&&"function"==typeof C&&C(),a?g(O,E.on.complete):e.io(k,E),b=(new Date).getTime()-I)}}else a?g(O,E.on.complete):e.io(k,E),b=(new Date).getTime()-I}function s(t,r,i){var s,o={},n=e.config.win;try{t&&n.performance&&n.performance.getEntriesByName&&(s=n.performance.getEntriesByName(t))&&s.length>0&&s[0]&&(s=s[s.length-1],o={dns:parseInt(s.domainLookupEnd-s.domainLookupStart),tcp:parseInt(s.connectEnd-s.connectStart),ttfb:parseInt(s.responseStart-s.startTime),transfer:parseInt(s.responseEnd-s.responseStart),total:parseInt(s.responseEnd-s.startTime),connectTime:i}),i&&(o.connectTime=i),Object.keys(o).length>0&&!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("[FlickrAPI] XHR "+r+":",e.config.win.location.href,o)}catch(e){}}function o(t,r){var i=e.config.win;try{!YUI.Env.isServer&&e.config.win.beaconError&&r&&i.beaconError("[FlickrAPI] "+t+":",i.location.href,r)}catch(e){}}var n,a,c=e.betterCache,l=e.config.flickr.transport.default_timeout,d=10,f=/"id":"([0-9]+)"/g,u=/"nsid":"([0-9]+@N[0-9]+)"/g,p={photos:{},users:{}},h=new RegExp(e.config.flickr.api.write_api_method_regex),m={include:{"flickr.sharing.getServiceTypes":!0},exclude:{"flickr.sharing.getServices":!0,"flickr.sharing.canShare":!0,"flickr.sharing.getAuthorizeUrl":!0,"flickr.products.orders.getOrder":!0,"flickr.cameraroll.getMap":!0,"flickr.cameraroll.getMapVersion":!0,"flickr.cameraroll.getPhotosByOffset":!0,"flickr.cameraroll.tags.getPhotoIds":!0,"flickr.photos.getPhotos":!0,"flickr.photos.getFavorites":!0,"flickr.photos.upload.checkTickets":!0,"flickr.photos.recentlyDeleted":!0,"flickr.photos.recentlyUploaded":!0,"flickr.photos.recentlyUpdated":!0,"flickr.photosets.getList":!0,"flickr.people.getPhotos":!0,"flickr.activity.getNotificationsCount":!0,"flickr.feed.getFeed":!0,"flickr.activity.recentByType":!0,"flickr.feed.preferences.getUserPreferences":!0,"flickr.groups.invite.photo.invite":!0,"flickr.feed.preferences.muteObject":!0,"flickr.feed.preferences.unmuteObject":!0,"flickr.feed.preferences.muteEventType":!0,"flickr.subscriptions.validateCoupon":!0,"flickr.galleries.getList":!0,"flickr.galleries.getPhotos":!0,"flickr.galleries.getContext":!0,"flickr.galleries.getInfo":!0,"flickr.people.getGroupsWithStatus":!0,"flickr.groups.pools.getPhotos":!0,"flickr.groups.pools.getGroups":!0,"flickr.groups.admin.getPendingPhotos":!0,"flickr.prefs.setPrefs":!0,"flickr.prefs.getPrefs":!0,"flickr.prefs.setActivityFilter":!0,"flickr.account.getAuthorizedServices":!0,"flickr.galleries.comments.getList":!0}},g=require("xhr");YUI.F=YUI.F||{},YUI.F.jsonCallbacks={},e.ClientTransport=n=function(e){this.keys=n._keys,a=e["enable-xhr-lib-for-client-xhrs"]},n._keys={csrf:null,siteKey:null},n.authorize=function(t){n._keys.siteKey=new e.SiteKey(null,t.flickrAPI),n._keys.siteKey.scheduleFutureFetch(),n._keys.csrf=new e.CsrfUpdater(t.flickrAPI),n._keys.csrf.scheduleFutureFetch()},e.ClientTransport.prototype={makeRequest:function(e,t){return r.call(this,e,t)},makeSiteKeyRequest:function(){return new e.Promise(function(t,r){a?g({uri:"/hermes_error_beacon.gne"},function(e,i,s){var o;i=i.rawRequest;try{o=JSON.parse(i.responseText)||{}}catch(e){return r({status:0,message:"invalid JSON in response",resp:i})}if(!o.site_key)return r({status:0,message:"invalid JSON content, no site_key found",resp:i});t(o)}):e.io("/hermes_error_beacon.gne",{method:"GET",timeout:l,on:{complete:function(e,i){var s;try{s=JSON.parse(i.responseText)||{}}catch(e){return r({status:0,message:"invalid JSON in response",resp:i})}if(!s.site_key)return r({status:0,message:"invalid JSON content, no site_key found",resp:i});t(s)}}})})},makeCsrfRequest:function(t){e.ClientApp&&e.ClientApp.disableClientNav()}}},"@VERSION@",{requires:["querystring-stringify","better-cache","io-xdr","flickr-router","site-key","csrf-updater","flickr-promise","client-app"],affinity:"client"});