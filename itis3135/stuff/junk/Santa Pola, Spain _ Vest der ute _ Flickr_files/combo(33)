YUI.add("hermes-template-group-discussion-rail-item",function(l,n){var t=l.Template.Handlebars.revive({1:function(l,n,t,a,e){var i,r,o=null!=n?n:l.nullContext||{},s=l.hooks.helperMissing,u=l.escapeExpression,c=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t\t<a\n\t\t\t\tclass="avatar group tiny"\n\t\t\t\thref="'+u("function"==typeof(r=null!=(r=c(t,"url")||(null!=n?c(n,"url"):n))?r:s)?r.call(o,{name:"url",hash:{},data:e,loc:{start:{line:6,column:10},end:{line:6,column:17}}}):r)+'"\n\t\t\t\tstyle="background-image: url('+u(l.lambda(null!=(i=null!=n?c(n,"iconUrls"):n)?c(i,"default"):i,n))+');"\n\t\t\t\tdata-group-nsid="'+u("function"==typeof(r=null!=(r=c(t,"groupId")||(null!=n?c(n,"groupId"):n))?r:s)?r.call(o,{name:"groupId",hash:{},data:e,loc:{start:{line:8,column:21},end:{line:8,column:32}}}):r)+'"></a>\n'},3:function(l,n,t,a,e){var i=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t"+l.escapeExpression((i(t,"intlMessage")||n&&i(n,"intlMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlMessage",hash:{time:null!=n?i(n,"time"):n,intlName:null!=n?i(n,"intlName"):n},data:e,loc:{start:{line:18,column:5},end:{line:18,column:48}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(l,n,t,a,e){var i,r,o=null!=n?n:l.nullContext||{},s=l.lambda,u=l.escapeExpression,c=l.hooks.helperMissing,p=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<div class="group-discussion-rail-item">\n\t<div class="avatar-container">\n'+(null!=(i=p(t,"if").call(o,null!=n?p(n,"iconUrls"):n,{name:"if",hash:{},fn:l.program(1,e,0),inverse:l.noop,data:e,loc:{start:{line:3,column:2},end:{line:9,column:9}}}))?i:"")+'\t</div>\n\t<div class="info-container">\n\t\t<a class="subject" href="'+u(s(null!=(i=null!=n?p(n,"topic"):n)?p(i,"url"):i,n))+'" data-link-id="group_discussion_rail_topic_link">'+u(s(null!=(i=null!=n?p(n,"topic"):n)?p(i,"subject"):i,n))+'</a>\n\t\t<div class="details">\n\t\t\t<a class="group-title" href="'+u("function"==typeof(r=null!=(r=p(t,"url")||(null!=n?p(n,"url"):n))?r:c)?r.call(o,{name:"url",hash:{},data:e,loc:{start:{line:14,column:32},end:{line:14,column:39}}}):r)+'" data-link-id="group_discussion_rail_group_link">'+u("function"==typeof(r=null!=(r=p(t,"groupName")||(null!=n?p(n,"groupName"):n))?r:c)?r.call(o,{name:"groupName",hash:{},data:e,loc:{start:{line:14,column:89},end:{line:14,column:102}}}):r)+'</a>\n\t\t\t<span class="details-separator">&middot;</span>\n\t\t\t<a class="timestamp" href="'+u(s(null!=(i=null!=n?p(n,"topic"):n)?p(i,"url"):i,n))+'" data-link-id="group_discussion_rail_topic_link">\n'+(null!=(i=(p(t,"friendlySinceDate")||n&&p(n,"friendlySinceDate")||c).call(o,null!=(i=null!=n?p(n,"topic"):n)?p(i,"lastPostDate"):i,!0,!0,{name:"friendlySinceDate",hash:{},fn:l.program(3,e,0),inverse:l.noop,data:e,loc:{start:{line:17,column:4},end:{line:19,column:26}}}))?i:"")+"\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>"},useData:!0}),a={};l.Array.each([],function(n){var t=l.Template.get("hermes/"+n);t&&(a[n]=t)}),l.Template.register("hermes/group-discussion-rail-item",function(n,e){return e=e||{},e.partials=e.partials?l.merge(a,e.partials):a,t(n,e)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-size-helper",function(e,t){var i=require("hermes-core/flog")(t);e.PhotoSizeHelper=function(t){return{getPhotoAspectRatio:function(e){var t=this.getBiggestGeneratedSize(e);return t.width/t.height},getBiggestGeneratedSize:function(e){var t,i=[];for(t in e)"o"!==t&&i.push(e[t]);return i.sort(function(e,t){return e.width<=t.width?1:-1}),i[0]},getSizeToFit:function(t,r,n){var h,s,o,u=r.width,a=r.height,c=!!n.cropToFit,p=n.includeSquare,d=n.excludeSizes||["o"],f=n.includeSizes,g=this.isPhotoSquare(t);if(void 0===n.includeSizes)try{f=Object.keys(t)}catch(e){i.warn("getSizeToFit with invalid sizes",{err:e,sizes:t})}return e.Object.each(t,function(e,t){var i,r,n,S,z;e&&-1===d.indexOf(t)&&f.indexOf(t)>-1&&(p||!this.isSquareType(t)||g)&&(i=parseInt(e.width,10),r=parseInt(e.height,10),c&&i>=u&&r>=a?n=!0:!c&&(i>=u||r>=a)&&(n=!0),n&&(h?r<parseInt(h.height,10)&&(h=e):h=e),s?(S=parseInt(s.width,10),z=parseInt(s.height,10),(i>S||r>z)&&(s=e)):s=e),o=h||s},this),o},isSquareType:function(e){return["sq","q"].indexOf(e)>-1},hasSquareDimensions:function(e){return parseInt(e.width,10)/parseInt(e.height,10)==1},isPhotoSquare:function(t){var i=!0;return e.Object.some(t,function(e,t){if(e&&e.width&&e.height&&1!=parseInt(e.width,10)/parseInt(e.height,10))return i=!1,!0},this),i},parseApiSizes:function(t,i){return e.APIHelper.response.parsePhotoSize(t,i)}}}},"@VERSION@",{requires:["api-helper"]});YUI.add("group-discussion-rail-card-view",function(e,i){require("hermes-core/flog")(i);e.namespace("Views")[this.name]=e.Base.create("group-discussion-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.groupItems=i.groupItems||[],this.photoSizeHelper=new e.PhotoSizeHelper(this.appContext)},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-discussion-rail-card",{})},activate:function(){var i=this,t=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Group Discussion","Rail Card Loaded"),this.dummyLoaderNode=t.one(".dummy-loader"),this.listContainerNode=t.one(".list-container"),this.currentContainerWidth=t.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.groupItems&&this.groupItems.length>0?e.Promise.resolve():this.loadDiscussions()).then(function(){i.buildLayout(i.groupItems)}).then(function(){i.dummyLoaderNode.addClass("hidden")})},buildLayout:function(e){var i=this;e.forEach(function(e){var t=i.templates("group-discussion-rail-item")(e);i.listContainerNode.appendChild(t)})},loadDiscussions:function(){var i=this;return this.appContext.callAPI("flickr.groups.discuss.getRecentTopics",{group_count:3,topic_count:1,extras:"icon_urls"}).then(function(t){t&&t.groups&&t.groups.forEach(function(t){if(t.topics){var s=t.topics[0],r=t.pathAlias||t.id,n={id:e.guid(),groupId:t.id,groupName:t.name._content,iconUrls:t.iconurls,url:"/groups/"+r,topic:{id:s.id,subject:s.subject,lastPostDate:s.datelastpost,url:"/groups/"+r+"/discuss/"+s.id}};i.groupItems.push(n)}})})},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})},"@VERSION@",{requires:["flickr-view","hermes-template-group-discussion-rail-card","hermes-template-group-discussion-rail-item","photo-size-helper"],langBundles:["common","feed","relative-dates"]});YUI.add("hermes-template-explore-rail-card",function(t,e){var a=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,e,a,l,i){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="explore-rail-card">\n\t<h2 class="title">\n\t\t<a href="/explore" data-link-id="explore_rail_title_link">'+t.escapeExpression((s(a,"intlMessage")||e&&s(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.EXPLORE_POPULAR_PHOTOS"},data:i,loc:{start:{line:3,column:60},end:{line:3,column:114}}}))+'</a>\n\t</h2>\n\t<div class="list-container">\n\t\t<div class="dummy-loader">\n\t\t\t<div class="row">\n\t\t\t\t<div class="box" style="width: 40%"></div>\n\t\t\t\t<div class="box" style="width: 25%"></div>\n\t\t\t\t<div class="box" style="width: 30%"></div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="box" style="width: 25%"></div>\n\t\t\t\t<div class="box" style="width: 30%"></div>\n\t\t\t\t<div class="box" style="width: 40%"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),l={};t.Array.each([],function(e){var a=t.Template.get("hermes/"+e);a&&(l[e]=a)}),t.Template.register("hermes/explore-rail-card",function(e,i){return i=i||{},i.partials=i.partials?t.merge(l,i.partials):l,a(e,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-lite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{update:e.PhotoModelHelper.updateEngagement,addReaction:function(t){return e.ModelUpdaters["flickr-reactions-add"].run(t,this.appContext)},removeReaction:function(t){return e.ModelUpdaters["flickr-reactions-remove"].run(t,this.appContext)}},toggleFave:e.PhotoModelHelper.toggleFave,addAsFave:e.PhotoModelHelper.addAsFave,toggleReaction:function(e,t,r){var o=this.getValue(e,"reactions")[t].count,i=Object.assign({},this.getValue(e,"reactions")),a=Object.assign({},i[t]);return a.didViewerReact=r,a.count=r?o+1:o-1,i[t]=a,this.setValue(e,"reactions",i),"photo-engagement-models"!==this.name&&this.appContext.getModelRegistry("photo-engagement-models").then(function(o){o.exists(e)&&o.toggleReaction(e,t,r)}),this.getValue(e,"reactions")[t]},updateReactionRemote:function(t,r){return e.Promise.resolve({})},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,attributes:{owner:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{id:r.getValue(t,"ownerNsid"),getValue:function(e){return"id"===e?r.getValue(t,"ownerNsid"):"nsid"===e?r.getValue(t,"ownerNsid"):"url"===e?r.getValue(t,"ownerUrl"):r.getValue(t,e)},toJSON:function(){return{id:r.getValue(t,"ownerNsid"),url:r.getValue(t,"ownerUrl"),pathAlias:r.getValue(t,"pathAlias"),username:r.getValue(t,"username"),realname:r.getValue(t,"realname"),displayname:r.getValue(t,"displayname"),nsid:r.getValue(t,"ownerNsid"),ownerUrl:r.getValue(t,"ownerUrl"),isMe:r.getValue(t,"isMe")}},exists:function(e){return!1}}}},pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,ownerUrl:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,engagement:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{registry:this,getValue:function(e){return r.getValue(t,e)},toJSON:function(){return{ownerNsid:r.getValue(t,"ownerNsid"),isFaved:r.getValue(t,"isFaved"),faveCount:r.getValue(t,"faveCount"),commentCount:r.getValue(t,"commentCount"),canFave:r.getValue(t,"canFave"),reactions:r.getValue(t,"reactions")}},exists:function(e){return!1}}}},ownerNsid:e.PhotoModelHelper.attributes.ownerNsid,isFaved:e.PhotoModelHelper.attributes.isFaved,faveCount:e.PhotoModelHelper.attributes.faveCount,commentCount:e.PhotoModelHelper.attributes.commentCount,canFave:e.PhotoModelHelper.attributes.canFave,title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},reactions:{defaultValue:{like:{id:"like",count:5,didViewerReact:!0,canReact:!0},someOtherReaction:{id:"someOtherReaction",count:3,didViewerReact:!1,canReact:!0}},derivedBy:["canFave"],getter:function(e,t){var r=this.getValue(t,"canFave");return e&&e.like&&(e.like.canReact=r,e.like.didViewerReact=!!r&&e.like.didViewerReact),e}}}})},"@VERSION@",{requires:["flickr-model-registry","photo-model-helper","person-model-helper","flickr-favorites-add-updater","flickr-favorites-remove-updater","photo-models","photo-engagement-models","person-models"]});YUI.add("flickr-explore-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-explore-getContext"]={run:function(t,r){var s=this;return e.Promise.all([r.callAPI("flickr.explore.getContext",this._processParams(t),!0),r.getModelRegistry("explore-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then(function(e){return s._processResponse(e,t)},function(e){throw 1===e.code&&"Photo not in explore"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext,date:o.date}},_processResponse:function(o,t){var r,s,n,p,l,a,i=o[0],h=o[1],d=o[2],g=o[3],u=o[4],m=o[5],x=[],c=[],y=d.proxy(t.photoId),M=[];return r=i.nextphotos,s=i.prevphotos,c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=h.getValue(t.id,"photoContextList"),p=!!a.hasMinBoundary&&a.hasMinBoundary(),l=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:c,prev:x.reverse(),current:n,hasMin:p,hasMax:l,numNext:t.numNext,numPrev:t.numPrev}),h.setValue(t.id,"photoContextList",M),{next:c,previous:x.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["explore-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("explore-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,langBundles:this.details.langBundles,remote:{read:function(t){return e.ListFetchers["flickr-interestingness-getList"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-interestingness-getList"]}},totalItems:{defaultValue:0,setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-explore-getContext"],listItemIdField:"photoId"}},displayType:{readOnly:!0,defaultValue:"explore"},url:{readOnly:!0,defaultFn:function(e){return"/explore/"+e.replace(/-/g,"/")}},urlSuffix:{readOnly:!0,defaultFn:function(e){return"explore-"+e}},title:{readOnly:!0,defaultFn:function(e){return this.intlMessage({intlName:"models.EXPLORE_TITLE",id:e})}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-interestingness-getList-fetcher","flickr-explore-getContext-fetcher"],langBundles:["models"]});