YUI.add("hermes-template-photo-page-leader-ad",function(e,a){var r=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,r,t,l){var n,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="photo-page-leader">\n\t<div class="photo-page-leader-container">\n'+(null!=(n=e.invokePartial(o(t,"prbd-moola-position"),a,{name:"prbd-moola-position",hash:{upgradeProLink:null!=(n=null!=a?o(a,"adConfig"):a)?o(n,"upgradeProLink"):n,audienceTargets:null!=(n=null!=a?o(a,"adConfig"):a)?o(n,"audienceTargets"):n,upsellFallback:!0,adUnit:null!=(n=null!=a?o(a,"adConfig"):a)?o(n,"adUnit"):n},data:l,indent:"\t\t",helpers:r,partials:t,decorators:e.decorators}))?n:"")+"\t</div>\n</div>\n"},usePartial:!0,useData:!0}),t={};e.Array.each(["prbd-moola-position"],function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)}),e.Template.register("hermes/photo-page-leader-ad",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,r(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position"]});YUI.add("photo-page-leader-ad-view",function(e,a){require("hermes-core/flog")(a);var i=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("photo-page-leader-ad-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("photo-page-leader-ad",{adConfig:{adUnit:e.config.flickr.moola.positions.photopage[0].ad_unit_leaderboard,audienceTargets:this.appContext.audienceTargets.getAudienceData(),upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS)}})},activate:function(){return this.appContext.adManager.processAdsOnPage(),e.Promise.resolve()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-leader-ad","subscriptions-helper"],langBundles:["common"]});YUI.add("photo-page-scrappy-view",function(e){var t=require("hermes-core/fletrics");e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var o=this;if(this.backToURL=t.backToURL,this.hideBackToLink=t.hideBackToLink||!1,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.nsid=t.nsid,this.geo=t.geo,this.showPhotoPageAd=!0,t.isOwner=this.isOwner,t.fullscreen?this.appContext.experiments.fullscreen.enableFullscreen():this.appContext.experiments.fullscreen.disableFullscreen(),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.context&&this.context.params&&this.context.params.isSharedEntity){var i=this.context.params;this.appContext.setGPCredentials({gp_code:i.gpCode,gp_owner:i.gpOwner,share_code:i.gpCode})}else this.appContext.setGPCredentials(null);return this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one&&e.one("head title").set("text",o.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),YUI.Env.isServer&&this.appContext&&this.appContext.flipper.isFlipped("enable-better-photo-page-seo")&&(this.appContext.forceServerRender=this.appContext._doForcedServerRender()),t.logViewTimings=!0,this},subviewConfig:{"photo-well-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"sub-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"moola-sticky-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"photo-page-leader-ad-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-photo-page-ad-bug")}}},additionalViewClasses:function(){var e=[];return this.appContext.getViewer().signedIn||e.push("has-global-nav"),e},getAdditionalSpContexts:function(){return e.Snowplough.getPhotoContextFromModel(this.get("photo"))},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t),e.appContext.adManager.canShowAd(e.get("photo"))||(e.showPhotoPageAd=!1)})},buildContainer:function(){return this.setContainerWithTemplate("photo-page-scrappy",{"global-nav-view":this.subviews["global-nav-view"].get("container"),"photo-well-view":this.subviews["photo-well-scrappy-view"]?this.subviews["photo-well-scrappy-view"].get("container"):"",showNonUSSticky:this.appContext.flipper.isFlipped("enable-sticky-ads")&&"US"!==this.geo.countryCode&&this.showPhotoPageAd&&!this.appContext.getViewer().signedIn}),t.increment("test.photo.page.requests"),this},activate:function(){return this.appContext.adManager.isEnabled()&&this.appContext.adManager.updatePhotoAdsCounter(),this.showPhotoPageAd&&this.appContext.adManager.processAdsOnPage(),this},closeDialog:function(t){e.config.win.location.href=this.backToURL},onSubviewEvent:function(e,t){var o;if(t&&t.length>0)if("make in view"===t[0]&&t.length>1);else if("close in view"===t[0]);else if("getDialogOffset"===t[0])t[1]&&"function"==typeof t[1]&&(o=this.subviews["photo-well-scrappy-view"].get("container"))&&t[1](parseInt(o.getStyle("right").replace("px",""),10)/2);else if("setRedirect"===t[0])this.get("container").all("input[name=redirect_url]").setAttribute("value",window.location.pathname),"function"==typeof t[1]&&t[1]();else{if("rightClickPhoto"===t[0])return!1;"photo:reload"===t[0]?this.reload(["photo-models","photostream-models","photo-exif-models"],this.photoId):"disable-sharing"!==t[0]&&"enable-sharing"!==t[0]||this.fire("parentViewEvent",t[0])}},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("photo").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},updateDataLayer:function(){var t=this.get("photo"),o=!t.getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,i=o&&0===t.getValue("safetyLevel");e.Analytics.setDataLayerProp("user.profile.segment.couldHaveSeenAd",o),e.Analytics.setDataLayerProp("user.profile.segment.safetyAwareCouldHaveSeenAd",i),e.Analytics.setDataLayerProp("page.pageInfo.safetyLevel",t.getValue("safetyLevel")>=0?e.SafetyHelper.getSafetyLevelString(t.getValue("safetyLevel"),"photo"):"")},destructor:function(){clearTimeout(this.scrollTimeout),this.appContext.adManager.stopInfolinksAdUnit()},buildErrorContainer:function(){this.error&&this.error.is404&&this.appContext.flapp.navigate("/error/notfound")}},{ATTRS:{spaceid:{value:792600543}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-scrappy","signin-helper","overflow-helper","url","safety-level-helper"],optional:["photo-well-scrappy-view","photo-head-meta-view","global-nav-view","sub-photo-view","moola-sticky-view","photo-page-leader-ad-view"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-empty-photo-page",function(e,t){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,l,a,n){var o=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return s((i(l,"outlet")||t&&i(t,"outlet")||r).call(o,null!=t?i(t,"global-nav-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n\t<h3>'+s((i(l,"intlHTMLMessage")||t&&i(t,"intlHTMLMessage")||r).call(o,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:n,loc:{start:{line:4,column:5},end:{line:4,column:70}}}))+"</h3>\n</div>\n\n"+s((i(l,"outlet")||t&&i(t,"outlet")||r).call(o,null!=t?i(t,"footer-full-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:7,column:0},end:{line:7,column:27}}}))+"\n"},useData:!0}),a={};e.Array.each([],function(t){var l=e.Template.get("hermes/"+t);l&&(a[t]=l)}),e.Template.register("hermes/empty-photo-page",function(t,n){return n=n||{},n.partials=n.partials?e.merge(a,n.partials):a,l(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return this.appContext.getViewer().signedIn||e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","overflow-helper","url"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-photo-page-lightbox",function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,l,r){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression((n(a,"outlet")||t&&n(t,"outlet")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?n(t,"photo-well-view"):t,{name:"outlet",hash:{},data:r,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+"\n"},useData:!0}),l={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)}),e.Template.register("hermes/photo-page-lightbox",function(t,r){return r=r||{},r.partials=r.partials?e.merge(l,r.partials):l,a(t,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-card-engagement-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-card-engagement-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0),this.signedIn=this.appContext.getViewer().signedIn,this.params=t,this.config={displayCurate:!("displayCurate"in t)||t.displayCurate,displayShare:"displayShare"in t&&t.displayShare,photoItem:t.photoItem,theme:t.theme,enableFaveKey:t.enableFaveKey},this.config.displayCurate=this.config.displayCurate&&this.signedIn,t.subviewParams={"like-engagement-item-view":{photoId:t.photoItem.photoId,showCount:!0,size:"small",isPadded:!1,theme:"overlay"===this.config.theme?"light":void 0},"fluid-share-photo-view":{photoId:t.photoItem.photoId,nsid:t.photoItem.owner.nsid,size:"small",theme:"light"}},this.curationHelper=new e.CurationHelper(this.appContext)},subviewConfig:{"like-engagement-item-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","like"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"fluid-share-photo-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","share"]}},buildContainer:function(){this.setContainerWithTemplate("photo-card-engagement",this.config)},activate:function(){var e=this.get("container");this.faveNode=e.one(".engagement-item.fave"),this.commentNode=e.one(".engagement-item.comment"),this.curateNode=e.one(".engagement-item.curate"),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count"),this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.config.enableFaveKey&&(this.keyEventHandler=this.attachKeyEvent("down:70",this.handleFaveKeyPress.bind(this)))),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentCountNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","key"],this.handleCurateClick.bind(this),"down:13"))},handleFaveKeyPress:function(e){70===e.keyCode&&this.handleFaveClick(e)},handleFaveClick:function(t){var n,o=this,a=this.faveNode,s=this.faveCountNode;this.faveNode.hasClass("can-not-fave")||(this.signedIn?this.isFaving||(this.isFaving=!0,this.config.photoItem.engagementModel.toggleFave(),n=this.config.photoItem.engagementModel.getValue("faveCount"),a.toggleClass("faved",this.config.photoItem.engagementModel.getValue("isFaved")),s.toggleClass("empty",0===n),s&&n>0?s.set("text",n):s.set("text",""),this.config.photoItem.engagementModel.remoteUpdate().then(function(){o.isFaving=!1},function(e){3!==e.code&&(o.config.photoItem.engagementModel.toggleFave(),a.toggleClass("faved",o.config.photoItem.engagementModel.getValue("isFaved")),s&&(s.set("text",n),s.toggleClass("empty",0===n))),i.error("Error faving photo",{err:e}),o.isFaving=!1})):this.showSignUpAndFaveModal(this.config.photoItem.photoId,e.config.win.location.href))},handleCommentClick:function(){var t=this,i=new e.Views["photo-comments-view"]({appContext:this.appContext,photoId:this.config.photoItem.photoId,isScrollable:!0,addCommentText:this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.config.photoItem.mediaType})}),n=new e.ModalDroparoundHelper(this.appContext,{configs:{common:{subview:i},droparound:{preferTop:!0,width:400,height:400,anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode},modal:{height:550,flexLayout:!0}}});n.show(),t.registerEventHandler(e.on("addComment:showingSignupModal",function(){n.close()})),t.registerEventHandler(n.on("close",function(){t.commentNode.removeClass("active"),t.fire("menuClosed")})),this.commentNode.addClass("active"),this.fire("menuOpened")},handleCurateClick:function(){var e=this,t=this.config.photoItem.isOwner;"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.config.photoItem.photoId,showAlbums:t,showGalleries:!t,anchorNode:this.curateNode}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",function(){e.fire("menuClosed"),e.curateNode.removeClass("active")}),this.curateNode.addClass("active"))},showSignUpAndFaveModal:function(t,i){var n,o=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),a=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:o,signUpMessage:a,beaconPrefix:"fave"}),this.registerEventHandler(n.on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})})),this.registerEventHandler(n.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})})),n.show()},toggleCommentNode:function(e){this.commentNode&&this.commentNode.toggleClass("hidden",!e)},toggleFaveNode:function(e){this.faveNode&&this.faveNode.toggleClass("hidden",!e)}})},"@VERSION@",{requires:["flickr-view","photo-comments-view","fluid-share-photo-view","hermes-template-photo-card-engagement","curation-helper","modal-droparound-helper"],langBundles:["common","comments","fave-view"]});