YUI.add("hermes-template-feed-error-message",function(e,n){var r=e.Template.Handlebars.revive({1:function(e,n,r,l,t){var a,o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<h2 class="error-title">'+e.escapeExpression("function"==typeof(a=null!=(a=o(r,"title")||(null!=n?o(n,"title"):n))?a:e.hooks.helperMissing)?a.call(null!=n?n:e.nullContext||{},{name:"title",hash:{},data:t,loc:{start:{line:3,column:26},end:{line:3,column:35}}}):a)+"</h2>\n"},3:function(e,n,r,l,t){var a=null!=n?n:e.nullContext||{},o=e.hooks.helperMissing,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<p class="error-message">'+e.escapeExpression((s(r,"preventOrphansHtml")||n&&s(n,"preventOrphansHtml")||o).call(a,(s(r,"renderTrustedMarkup")||n&&s(n,"renderTrustedMarkup")||o).call(a,null!=n?s(n,"message"):n,{name:"renderTrustedMarkup",hash:{},data:t,loc:{start:{line:6,column:48},end:{line:6,column:77}}}),{name:"preventOrphansHtml",hash:{},data:t,loc:{start:{line:6,column:27},end:{line:6,column:79}}}))+"</p>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,r,l,t){var a,o=null!=n?n:e.nullContext||{},s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<div class="feed-error-message">\n'+(null!=(a=s(r,"if").call(o,null!=n?s(n,"title"):n,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t,loc:{start:{line:2,column:1},end:{line:4,column:8}}}))?a:"")+(null!=(a=s(r,"if").call(o,null!=n?s(n,"message"):n,{name:"if",hash:{},fn:e.program(3,t,0),inverse:e.noop,data:t,loc:{start:{line:5,column:1},end:{line:7,column:8}}}))?a:"")+"</div>"},useData:!0}),l={};e.Array.each([],function(n){var r=e.Template.get("hermes/"+n);r&&(l[n]=r)}),e.Template.register("hermes/feed-error-message",function(n,t){return t=t||{},t.partials=t.partials?e.merge(l,t.partials):l,r(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("feed-helper",function(e,t){var a=e.mix({langBundles:["common","feed","feed-new"]},e.Localizable);e.FeedHelper=function(t){var n=new e.PhotoCardHelper(t),r=new e.TemplateLibraryHelper(t),o={photoCardHelper:n,layoutValues:{large:{CARD_SPACING:32,CARD_SPACING_MOBILE:16},medium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:280,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.5,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4,GENERATED_LAYOUT_ROW_HEIGHT_RATIO:.35,GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE:.3,MAX_BATCH_AR:2.5,MIN_BATCH_AR:1},compact:{CARD_SPACING:40,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4},batchLarge:{CARD_SPACING:16,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchMedium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchCompact:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3}},EVENT_TYPE_INTL:{Flickrec:{intlName:"feed.RECOMMENDED"},StaticRec:{intlName:"feed.RECOMMENDED"},SelfBatch:null,UploadBatch:null,GroupBatch:{intlName:"feed.GROUPS_ACTIVITY_LABEL"},ad:{intlName:"feed.SPONSORED"},StaticContent_Sponsored:{intlName:"feed.SPONSORED"},StaticContent_General:null,StaticContent_Help:null},PER_BATCH:15,AD_CADENCE:7,getCappedPhotoHeight:function(e){e.height;return Math.min(e.height,Math.max(t.viewportData.getHeight()*e.viewportProportion-e.additionalCardHeight,e.minHeight))},getEventTypeName:function(e){var t=this.EVENT_TYPE_INTL[e];return t?a.intlMessage(t):""},getItemAttribution:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":break;case"UploadBatch":t={id:e.photoItems[0].owner.nsid,title:e.photoItems[0].owner.displayname,url:"/photos/"+e.photoItems[0].owner.pathAlias,iconUrl:e.photoItems[0].owner.buddyicon.default,isPro:e.photoItems[0].owner.isPro,proBadgeType:e.photoItems[0].owner.proBadgeType};break;case"GroupBatch":t={id:e.groupId,title:e.groupName,url:"/groups/"+e.groupId,iconUrl:e.iconUrls.default};break;case"ad":case"StaticContent_Sponsored":break;case"StaticContent_General":t={title:a.intlMessage({intlName:"feed.FLICKR_EDITORIAL"}),url:e.staticContent.link};break;case"StaticContent_Help":t={title:a.intlMessage({intlName:"feed.FLICKR_HELP"}),url:e.staticContent.link}}return t.activityName=this.getEventTypeName(e.eventType),t.time=e.time,t},getLinkFooterConfig:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":break;case"UploadBatch":t={text:a.intlMessage({intlName:"feed.VIEW_IN_PHOTOSTREAM"}),url:"/photos/"+e.photoItems[0].owner.pathAlias};break;case"GroupBatch":t={text:a.intlMessage({intlName:"feed.VIEW_GROUP_POOL"}),url:"/groups/"+e.groupId+"/pool"}}return t},getEventTypes:function(e){var t="UploadBatch,GroupBatch,ContactRec";return e&&("groups"===e?t="GroupBatch":"people"===e?t="UploadBatch,ContactRec":"friends_and_family"===e&&(t="UploadBatch")),t},convertActivityModel:function(t){var a=this,n=t.getValue("photos").getList(),r=t.getValue("people"),o={id:e.guid(),layoutRenderType:"feedCard",batchId:t.getValue("id"),eventType:t.getValue("eventType"),owner:{nsid:t.getValue("ownerId")},isRecommended:t.getValue("recommended"),isStaticContent:t.getValue("isStaticContent"),isStaticHelp:t.getValue("isStaticHelp"),time:t.getValue("time"),count:t.getValue("count"),model:t};return"GroupBatch"===o.eventType&&(o.groupId=t.getValue("groupId"),o.groupName=t.getValue("groupName"),o.iconUrls=t.getValue("iconUrls")),o.eventType.indexOf("StaticContent")>-1&&(o.staticContent=t.getValue("data")),o.photoItems=n.map(function(e){return a.photoCardHelper.convertPhotoModel(e)}),r&&(o.personItems=r.map(function(e){return a.convertPerson(e)})),o},convertPerson:function(t){var a=t.model,n=a.getValue("isPro");return{id:e.guid(),nsid:a.getValue("nsid"),url:a.getValue("url"),displayname:a.getValue("displayname"),username:a.getValue("username"),buddyicon:a.getValue("buddyicon"),pathAlias:a.getValue("pathAlias"),isPro:n,proBadgeType:n?a.getValue("proBadge"):void 0,coverPhotoUrls:t.coverPhotoUrls,model:a}},generateListsFromItems:function(e){var t=0,a=[];return e.forEach(function(n,r){"ContactRec"===n.eventType||"ad"===n.eventType?(r>t&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r)}),a.push({layoutRenderType:"ad"===n.eventType?"ad":"people",items:[e[r]]}),t=r+1):r===e.length-1&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r+1)})}),a},checkInsideViewport:function(t,a,n){var r=t?t.getDOMNode().getBoundingClientRect():void 0;if(a=a||0,r&&r.height>0){if(n&&r.top>=-a&&r.bottom<=e.config.win.innerHeight+a)return!0;if(!n&&r.bottom>=-a&&r.top<=e.config.win.innerHeight+a)return!0}return!1},promiseSync:function(t,a){var n=this,r=t.shift();return a=a||[],r?r().then(function(e){return a.push(e),n.promiseSync(t,a)}):e.Promise.resolve(a)},getEmptyStateMessage:function(t,n){var o;switch(t){case"all":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"groups":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_GROUPS_1"}),message:a.intlMessage({intlName:"feed.EMPTY_GROUPS_2",groupsUrl:"/groups"})});break;case"people":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_PEOPLE_1"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"friends_and_family":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_1"}),message:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_2",peopleUrl:e.URLHelper.generatePersonUrls(n).list})});break;default:o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"})})}return o}};return e.augment(o,e.EventTarget),o}},"@VERSION@",{requires:["event-custom","storage-helper","photo-card-helper","url-helper","fluid-share-photo-view","fluid-share-photostream-view","hermes-template-feed-error-message"]});YUI.add("feed-new-page-view",function(e,t){var o=require("hermes-core/flog")(t),i=new e.SubscriptionsHelper,n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;e.namespace("Views")[this.name]=e.Base.create("feed-new-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.nsid=t.nsid,this.feedItemLists=[],this.feedItems={},this.itemModels=[],this.widowedItems=[],this.itemNodes={},this.cardViews={},this.batchJustifiedLayouts={},this.itemBoxes={},this.layoutType=t.layoutType,this.filterType=t.filterType,this.FILTER_TYPE_INTL={all:{intlName:"feed.NAV_ALL_ACTIVITY"},people:{intlName:"feed.NAV_PEOPLE_ONLY"},groups:{intlName:"feed.NAV_GROUPS_ONLY"},friends_and_family:{intlName:"feed.FRIENDS_AND_FAMILY"}},this.initialFeedUrl=YUI.Env.isServer?"":e.config.win.location.href,this.showFeedBannerAd=t.showFeedBannerAd,t.resetStoredBatchId&&e.StorageHelper.remove("currentFeedBatchId",!0),this.justifiedLayout=require("justified-layout"),this.helper=t.helper||new e.FeedHelper(this.appContext),this.photoCardHelper=t.photoCardHelper||new e.PhotoCardHelper(this.appContext),this.isMobileViewport=this.appContext.viewportData.getWidth()<=700,this.savedLayoutType=this.layoutType,this.layoutType=this.isMobileViewport?"large":this.layoutType,this.layoutValues=this.helper.layoutValues[this.layoutType],this.prevScrollTop=0,this.scrollDir=-1,this.railSpacerMargin=0,this.feedCardAdUnits=e.config.flickr.moola.positions.feed.slice(0,6),this.currentAdIndex=0},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"foot-banner-holder-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"feed-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,o=[];return o.push(this.appContext.getModel("person-models",this.nsid).then(function(e){t.viewerModel=e})),o.push(this.appContext.getModel("feed-list-models",this.nsid).then(function(e){t.feedListModel=e,t.feedListModel.getValue("feedList")||(t.feedListModel.setValue("feedList",[]),t.feedListModel.setValue("beforeCount",Number.MAX_VALUE),t.feedListModel.setValue("afterCount",Number.MAX_VALUE))})),e.Promise.all(o)},buildContainer:function(){var t=e.config.flickr.moola.positions.billboard[0];this.setContainerWithTemplate("feed-new-page",{layoutType:this.layoutType,filterName:this.intlMessage(this.FILTER_TYPE_INTL[this.filterType]),showFeedBannerAd:this.showFeedBannerAd,bannerAdConfig:{adUnit:t[this.appContext.viewportData.getWidth()<n?"ad_unit_mobile":"ad_unit_desktop"],audienceTargets:{signedIn:!0},upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS)}})},activate:function(){this.onCSSLoaded(this.handleCSSLoaded)},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),YUI.Env.isServer&&this.set("headContainer",e)},handleCSSLoaded:function(){var t=this,o=this.get("container");this.feedColumnNode=o.one(".feed-column"),this.loadTopButtonNode=this.feedColumnNode.one(".load-top-button"),this.feedColumnContentNode=this.feedColumnNode.one(".feed-column-content"),this.dummyLoaderNode=this.feedColumnNode.one(".dummy-loader-container"),this.toolsNode=o.one(".feed-new-tools-container"),this.filterMenuNode=this.toolsNode.one(".filter-menu-button"),this.infoColumnNode=o.one(".info-column"),this.infoColumnSpacer=o.one(".info-column-spacer"),this.infoColumnContentNode=this.infoColumnNode.one(".info-content-container"),this.loadErrorContainerNode=this.feedColumnNode.one(".feed-load-error-container"),this.scrollContainer=e.one("html"),this.containerHeight=this.appContext.viewportData.getHeight(),this.topLoader=this.feedColumnNode.one(".top-loader"),this.bottomLoader=this.feedColumnNode.one(".bottom-loader"),this.currentFeedColumnWidth=this.feedColumnContentNode.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",e.betterThrottle(this.handleScroll.bind(this),100,this,!1))),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",e.betterThrottle(this.handleScrollSlow.bind(this),500,this,!1))),this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.handleScrollUnthrottled.bind(this))),this.registerEventHandler(this.loadTopButtonNode.on("click",this.handleLoadLatestClick.bind(this))),this.registerEventHandler(o.one(".layout-tabs").delegate("click",this.handleLayoutClick.bind(this),".tab")),this.registerEventHandler(e.on("groupStatusHelper:groupMuteToggled",function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,e.isMuted)})),this.registerEventHandler(e.on("groupStatusHelper:groupLeft",function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,!0)})),this.registerEventHandler(e.on("groupStatusHelper:groupJoined",function(e){e.groupId&&t.toggleFadeGroupCards(e.groupId,!1)})),this.registerEventHandler(this.filterMenuNode.on("click",this.handleFilterClick.bind(this))),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),this.registerEventHandler(e.on("history:change",function(o){var i,n;"popstate"===o.src&&o.prevVal&&o.newVal&&(o.prevVal.flickr&&o.prevVal.flickr.referrer||o.newVal.flickr&&o.newVal.flickr.referrer)||(t.initialFeedUrl!==e.config.win.location.href?((i=t.getTopItemInView())&&e.StorageHelper.setItem("currentFeedBatchId",i.batchId,!0),n=new Date,t.feedListModel.setValue("expireTime",n.getTime()+12e4)):e.StorageHelper.remove("currentFeedBatchId",!0))})),this.registerEventHandler(this.appContext.flapp.before("activeViewChange",function(e){t.scrollContainer.set("scrollTop",0)})),this.registerEventHandler(e.on("unload",function(e){t.scrollContainer.set("scrollTop",0)})),t.appContext.adManager.processAdsOnPage(),e.Analytics.setDataLayerProp("feed.isInsideOverlay",!1),e.Analytics.setDataLayerProp("feed.layoutType",this.layoutType),e.Analytics.setDataLayerProp("feed.filterType",this.filterType),this.loadInitial()},loadInitial:function(){var t,o,i=this,n=0,a=[],r=e.StorageHelper.hasEntries("currentFeedBatchId",!0),s=new Date;if(r){t=e.StorageHelper.getItem("currentFeedBatchId",!0),e.StorageHelper.remove("currentFeedBatchId",!0);var l=this.feedListModel.getValue("feedList");return l&&l.length>=20&&s.getTime()<this.feedListModel.getValue("expireTime")?(this.updateStoredFeedListChunk(t,40,40),o=e.Promise.resolve({items:this.convertAndAddNewItems(this.feedListModel.getValue("feedList"),!1),beforeCount:this.feedListModel.getValue("beforeCount"),afterCount:this.feedListModel.getValue("afterCount")})):(this.clearFeedListModel(),o=this.loadMore({id:this.nsid,start:-17,end:20,batchId:t,isInitial:!0})),o.then(function(e){var t=e.items;return i.isAtTop=e.beforeCount<=0,i.isAtBottom=e.afterCount<=0,i.appContext.getModel("activity-models",i.nsid).then(function(e){return i.feedModel=e,t})}).then(function(o){return i.hideDummyLoader(),0===o.length?(i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),e.Promise.resolve(o)):(1===o.length&&"ContactRec"===o[0].eventType&&i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),o.length>0&&(1===(n=o.map(function(e){return e.batchId}).indexOf(t))&&"ContactRec"===o[0].eventType&&(n=0),a=i.helper.generateListsFromItems(o)),i.appendNewItemLists(a).then(function(){return o}))}).then(function(){var o;i.isAtTop?i.toggleLoadTopButton(!1):i.toggleLoadTopButton(!0),0!==n&&(o=e.one('[data-batch-id="'+t+'"]'),setTimeout(function(){e.AnchorRepositioner.jumpTo(o,0)},0),setTimeout(function(){i.isBatchStoringReady=!0},1e3)),i.isInitiallyLoaded=!0})}return this.loadMore({id:this.nsid,end:20,isInitial:!0}).then(function(t){var o=t.items,n=[];return i.isAtTop=t.beforeCount<=0,n.push(i.appContext.getModel("activity-models",i.nsid).then(function(e){return i.feedModel=e,o})),e.Promise.all(n).then(function(e){return o})}).then(function(t){var o=[];return i.hideDummyLoader(),0===t.length?(i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),e.Promise.resolve(t)):(1===t.length&&"ContactRec"===t[0].eventType&&i.showLoadError(!0,i.helper.getEmptyStateMessage(i.filterType,i.viewerModel)),o=i.helper.generateListsFromItems(t),i.appendNewItemLists(o).then(function(){return t}))}).then(function(e){return i.isBatchStoringReady=!0,i.isInitiallyLoaded=!0,e})},appendNewItemLists:function(e,t){var o=this,i=[];return this.isAppendingItems=!0,t&&e.reverse(),e.forEach(function(e){e.items.length>0&&(t?o.feedItemLists.unshift(e):o.feedItemLists.push(e),i.push(function(){return o.appendNewItems(e,t,t)}))}),this.helper.promiseSync(i).then(function(e){return o.isAppendingItems=!1,o.appContext.adManager.processAdsOnPage(),setTimeout(function(){Object.keys(o.feedItems).forEach(function(e){var t=o.feedItems[e];t.id in o.cardViews&&o.cardViews[t.id].setAwake(o.helper.checkInsideViewport(o.cardViews[t.id].get("container"),200))})},0),e})},handleScroll:function(){var e=this;this.isAppendingItems||(this.checkLoadMore(),Object.values(e.feedItems).forEach(function(t){t.id in e.cardViews&&t.id in e.itemNodes&&e.cardViews[t.id].setAwake(e.helper.checkInsideViewport(e.cardViews[t.id].get("container"),200))}))},handleScrollSlow:function(){var t=this.getTopItemInView();this.isBatchStoringReady&&t&&e.StorageHelper.setItem("currentFeedBatchId",t.batchId,!0)},handleScrollUnthrottled:function(){var t,o=this.scrollContainer.get("scrollTop"),i=this.appContext.viewportData.getHeight(),n=e.AnchorRepositioner.getTotalOffset(),a=n+20;if(this.prevScrollTop>o){if(1===this.scrollDir){if(t=this.infoColumnNode.get("offsetTop"),this.railHeight=this.infoColumnContentNode.get("clientHeight"),this.railHeight<i-a)return this.infoColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin);o+i-n-t>this.railHeight+this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,o+i-this.railHeight-t),this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=-1,this.infoColumnContentNode.setStyle("bottom",i-this.railHeight-a),this.infoColumnContentNode.setStyle("top","initial")}}else if(this.prevScrollTop<o&&-1===this.scrollDir){if(t=this.infoColumnNode.get("offsetTop"),this.railHeight=this.infoColumnContentNode.get("clientHeight"),this.railHeight<i-a)return this.infoColumnContentNode.setStyle("top",a),this.railSpacerMargin=0,void this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin);o-t+a<this.railSpacerMargin&&(this.railSpacerMargin=Math.max(0,o-t+a),this.infoColumnSpacer.setStyle("margin-top",this.railSpacerMargin)),this.scrollDir=1,this.infoColumnContentNode.setStyle("bottom","initial"),this.infoColumnContentNode.setStyle("top",i-this.railHeight)}this.prevScrollTop=o},loadMore:function(t){var i=this;return this.isLoadingMore=!0,this.toggleListLoader("bottom",!0),e.Analytics.sendClick("Feed Load More Continuated: Bottom","Feed Load More Continuated"),(this.nextLoadContinuatedPromise?this.nextLoadContinuatedPromise:this.loadContinuated(t)).then(function(e){var t=e.activityModels,o=i.convertAndAddNewItems(t,!1),n=i.feedListModel.getValue("beforeCount"),a=i.feedListModel.getValue("afterCount");return i.feedListModel.setValue("feedList",i.feedListModel.getValue("feedList").concat(e.activityModels)),i.feedListModel.setValue("beforeCount",e.beforeCount<n?e.beforeCount:n),i.feedListModel.setValue("afterCount",e.afterCount<a?e.afterCount:a),i.isAtBottom=e.afterCount<=0,{items:o,beforeCount:e.beforeCount,afterCount:e.afterCount}}).then(function(e){return i.isLoadingMore=!1,i.toggleListLoader("bottom",!1),i.isAtBottom||(i.nextLoadContinuatedPromise=i.loadContinuated({start:1,end:50,batchId:e.items.length>0?e.items[e.items.length-1].batchId:void 0})),e}).catch(function(e){throw o.error("Error loading more feed items",{err:e}),i.isLoadingMore=!1,i.toggleListLoader("bottom",!1),e})},loadMoreBefore:function(){var t=this;return this.isLoadingMore=!0,this.toggleListLoader("top",!0),e.Analytics.sendClick("Feed Load More Continuated: Top","Feed Load More Continuated"),this.loadContinuated({start:-20,end:-1,batchId:this.itemModels.length>0?this.itemModels[0].id:void 0}).then(function(o){var i,n=o.activityModels;return 0===n.length||1===n.length&&n[0].id===t.itemModels[0].id?(t.isAtTop=!0,e.Promise.resolve()):(i=t.convertAndAddNewItems(n,!0),{items:i,beforeCount:o.beforeCount})}).then(function(e){return t.isLoadingMore=!1,t.toggleListLoader("top",!1),e}).catch(function(e){throw o.error("Error loading more feed items",{err:e}),t.isLoadingMore=!1,t.toggleListLoader("top",!1),e})},appendNewItems:function(e,t,o){return this.buildLayout(e,t,o)},buildLayout:function(e,t,o){return"people"===e.layoutRenderType?this.buildPeopleCardLayout(e.items,t,o):"ad"===e.layoutRenderType?this.buildAdCardLayout(e.items,t,o):(t||(this.widowedItems.forEach(function(t){e.items.unshift(t)}),this.widowedItems=[]),this.buildPhotoCardLayout(e.items,t,o))},buildPeopleCardLayout:function(t,o,i){var n=this,a=t[0];return n.appContext.getView("people-card-view",{id:a.id,item:a,personItems:a.personItems}).then(function(e){return e.initialize()}).then(function(t){var i=e.Node.create('<div class="feed-layout"></div>'),r=e.Node.create('<div class="feed-item" data-batch-id="'+a.batchId+'" data-batch-id="'+a.batchId+'"></div>');return i.setStyle("position","relative"),i.setStyle("margin-bottom",n.layoutValues.CARD_SPACING),r.appendChild(t.get("container")),i.appendChild(r),o?n.feedColumnContentNode.prepend(i):n.feedColumnContentNode.append(i),n.registerEventHandler(t.on("batchLayoutMoreClicked",n.showBatchOverlay.bind(n))),t.activate().then(function(){return i})})},buildAdCardLayout:function(t,o,a){var r=t[0],s=e.Node.create('<div class="feed-layout"></div>'),l=this.appContext.viewportData.getWidth()<=n,d=this.templates("ad-card")({adConfig:{adUnit:l?r.adConfig.ad_unit_mobile:r.adConfig.ad_unit_desktop,audienceTargets:{signedIn:!0},upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS)},theme:"compact"===this.layoutType?"flat":void 0}),h=e.Node.create('<div class="feed-item" data-item-id="'+r.id+'">'+d+"</div>");return s.setStyle("margin-bottom",this.layoutValues.CARD_SPACING),s.appendChild(h),o?this.feedColumnContentNode.prepend(s):this.feedColumnContentNode.append(s),e.Promise.resolve(s)},buildPhotoCardLayout:function(t,o,i){var n,a=this,r=a.layoutType,s=[],l=e.Node.create('<div class="feed-layout"></div>');return l.setStyle("position","relative"),"large"===r?t.forEach(function(e){var t=e.photoItems[0].aspectRatio,o=a.feedColumnContentNode.get("clientWidth"),i=a.helper.getCappedPhotoHeight({height:o/t,additionalCardHeight:a.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+a.photoCardHelper.DETAILS_FOOTER_HEIGHT+a.photoCardHelper.INFO_BAR_HEIGHT,minHeight:200,viewportProportion:1});a.itemBoxes[e.id]={aspectRatio:t,width:o,height:i}}):"medium"===r&&(n=this.prepareMediumLayout(t,i),l.setStyle("height",n.containerHeight),l.setStyle("margin-bottom",this.layoutValues.CARD_SPACING)),t.forEach(function(e,t){var o=a.itemBoxes[e.id],i=e.photoItems[0],n=a.batchJustifiedLayouts[e.id],l=e.photoItems.length>1||"compact"===r,d=a.helper.getItemAttribution(e),h=(l||"GroupBatch"===e.eventType)&&"compact"!==r,u=a.helper.getLinkFooterConfig(e),p="/in/feed-"+e.batchId,c=!l&&"GroupBatch"===e.eventType,f={};"GroupBatch"===e.eventType?(f.type="Group",f.groupId=e.groupId,f.eventType=e.eventType,f.isFaded=e.isFaded):e.photoItems.length>1?(f.type="PersonBatch",f.owner=e.photoItems[0].owner,f.photoId=e.photoItems[0].photoId):(f.type="Person",f.owner=e.photoItems[0].owner,f.photoId=e.photoItems[0].photoId),s.push(a.appContext.getView("photo-card-view",{item:e,feedHelper:a.helper,showHeader:!0,isBatchLayout:l,showLinkFooter:h,showDetailsFooter:!h&&"large"===r,showInfoBar:!h&&!l&&"compact"!==r,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,batchLayout:n,isFaded:e.isFaded,box:o,cardType:r,theme:"compact"===r?"flat":void 0,batchConfig:{layoutType:r,photoConfig:{showDetailsFooterOverlay:"large"===r,showInfoBarOverlay:!0,showHeadOverlay:"GroupBatch"===e.eventType,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,shouldContain:!1,urlContext:p,hasHoverPlay:!1}},headerConfig:{title:d.title,url:d.url,iconUrl:d.iconUrl,time:d.time,activityName:d.activityName,isCompact:"compact"===r,isGroupAttribution:"GroupBatch"===e.eventType,isPersonAttribution:"UploadBatch"===e.eventType,attributionId:d.id,showProBadge:d.isPro,proBadgeType:d.proBadgeType,showMenu:!0,menuConfig:f},photoConfig:{photoItem:i,box:o,showDetailsFooterOverlay:"large"===r&&c,showInfoBarOverlay:c,showInfoBarTitle:"medium"===r||"compact"===r,showInfoBarViews:"large"===r,shouldContain:"large"===r,urlContext:p,showPhotoInterstitial:i.needsInterstitial,photoInterstitialContent:i.needsInterstitial?a.templates("adult-content-photo-overlay")({isCompact:"compact"===r,photoUrl:i.url+p}):void 0,hasHoverPlay:i.isVideo,showHeadOverlay:c,headerConfig:c?{title:i.owner.displayname,url:"/photos/"+i.owner.pathAlias,iconUrl:i.owner.buddyicon.default,isPersonAttribution:!0,attributionId:i.owner.nsid,isCompact:!0,showMenu:!1,theme:"overlay",showProBadge:i.owner.isPro,proBadgeType:i.owner.proBadgeType}:void 0},linkFooterConfig:u}).then(function(e){return e.initialize()}))}),e.Promise.all(s).then(function(t){var i=[];return t.forEach(function(t,o){var i=t.params.item,n=a.itemBoxes[i.id],s=t.get("container"),d=e.Node.create('<div class="feed-item" data-item-id="'+i.id+'" data-batch-id="'+i.batchId+'"></div>');"large"===r?d.setStyle("margin-bottom",a.isMobileViewport?a.layoutValues.CARD_SPACING_MOBILE:a.layoutValues.CARD_SPACING):"medium"===r?(d.setStyle("position","absolute"),d.setStyle("flex-direction","column"),d.setStyle("top",n.top),d.setStyle("left",n.left),d.setStyle("width",n.width),d.setStyle("height",n.height+a.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+a.photoCardHelper.INFO_BAR_HEIGHT)):"compact"===r&&d.setStyle("margin-bottom",a.layoutValues.CARD_SPACING),d.appendChild(s),l.appendChild(d),a.itemNodes[i.id]=d,a.cardViews[i.id]=t,a.registerEventHandler(t.on("batchLayoutMoreClicked",a.showBatchOverlay.bind(a)))}),o?a.feedColumnContentNode.prepend(l):a.feedColumnContentNode.append(l),t.forEach(function(e,t){i.push(e.activate())}),e.Promise.all(i).then(function(){return l})})},prepareMediumLayout:function(e,t){var o,i=this,n=[],a=this.helper.layoutValues[this.layoutType].MAX_BATCH_AR,r=this.helper.layoutValues[this.layoutType].MIN_BATCH_AR;return e.forEach(function(e){var t,o,s,l=[],d=[];if(1===e.photoItems.length)n.push(e.photoItems[0].aspectRatio);else{if(l=e.photoItems.map(function(e){return i.photoCardHelper.getClampedPhotoAspectRatio(e.aspectRatio)}),l=l.slice(0,5),o=i.justifiedLayout(l,{containerWidth:i.layoutValues.GENERATED_LAYOUT_WIDTH,containerPadding:0,boxSpacing:{horizontal:i.layoutValues.GENERATED_LAYOUT_SPACING,vertical:i.layoutValues.GENERATED_LAYOUT_SPACING},targetRowHeight:i.layoutValues.GENERATED_LAYOUT_ROW_HEIGHT_RATIO*i.layoutValues.GENERATED_LAYOUT_WIDTH,targetRowHeightTolerance:i.layoutValues.GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE,maxNumRows:2}),o.width=i.layoutValues.GENERATED_LAYOUT_WIDTH,s=void 0,o.boxes.forEach(function(e,t){e.top!==s&&(s=e.top,d.push(t))}),2===d.length&&o.widowCount>0&&((o=i.justifiedLayout(l.slice(0,2),{containerWidth:i.layoutValues.GENERATED_LAYOUT_WIDTH,containerPadding:0,boxSpacing:{horizontal:i.layoutValues.GENERATED_LAYOUT_SPACING,vertical:i.layoutValues.GENERATED_LAYOUT_SPACING},targetRowHeight:i.layoutValues.GENERATED_LAYOUT_ROW_HEIGHT_RATIO*i.layoutValues.GENERATED_LAYOUT_WIDTH,targetRowHeightTolerance:i.layoutValues.GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE,maxNumRows:1})).width=i.layoutValues.GENERATED_LAYOUT_WIDTH,d=[],s=void 0,o.boxes.forEach(function(e,t){e.top!==s&&(s=e.top,d.push(t))})),1===d.length&&o.widowCount===o.boxes.length){var h=o.boxes.reduce(function(e,t,n){var a=n!==o.boxes.length-1?i.layoutValues.GENERATED_LAYOUT_SPACING:0;return e+t.width+a},0),u=o.width/h;o.boxes.forEach(function(e,t){e.width*=u,e.height*=u,e.left*=u}),o.containerHeight*=u}(t=o.width/o.containerHeight)>a?(o=i.photoCardHelper.scaleLayout(o,t/a,i.layoutValues.GENERATED_LAYOUT_SPACING,!0,!1),t=a):t<r&&(o=i.photoCardHelper.scaleLayout(o,r/t,i.layoutValues.GENERATED_LAYOUT_SPACING,!1,!0),t=r),i.batchJustifiedLayouts[e.id]=o,n.push(t)}}),o=this.justifiedLayout(n,{containerWidth:this.feedColumnContentNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:this.layoutValues.CARD_SPACING,vertical:this.layoutValues.CARD_SPACING+this.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+this.photoCardHelper.INFO_BAR_HEIGHT},targetRowHeight:this.isMobileViewport?this.layoutValues.TARGET_ROW_HEIGHT_MOBILE:this.layoutValues.TARGET_ROW_HEIGHT,targetRowHeightTolerance:this.layoutValues.TARGET_ROW_HEIGHT_TOLERANCE,showWidows:t}),o.containerHeight+=this.photoCardHelper.ATTRIBUTION_HEADER_HEIGHT+this.photoCardHelper.INFO_BAR_HEIGHT,t||(this.widowedItems=e.splice(o.boxes.length)),o.boxes.forEach(function(t,o){i.itemBoxes[e[o].id]=t}),o},convertAndAddNewItems:function(t,o){var i,n,a,r=this,s=[];if(t.forEach(function(e){s.push(r.helper.convertActivityModel(e))}),!this.appContext.getViewer().isPro)for(i=this.helper.AD_CADENCE;i<s.length;i+=7)n=this.feedCardAdUnits[this.currentAdIndex++%6],a={id:e.guid(),eventType:"ad",adConfig:n},s.splice(i,0,a);return o?(this.itemModels=t.concat(this.itemModels),s.forEach(function(e){r.feedItems[e.id]=e})):(this.itemModels=this.itemModels.concat(t),s.forEach(function(e){r.feedItems[e.id]=e})),s},hideOutsideRows:function(){},checkLoadMore:function(){var e=this,t=this.scrollContainer.get("scrollTop"),o=this.scrollContainer.get("scrollHeight");!this.isLoadingMore&&t+this.containerHeight+4e3>o&&!this.isAtBottom&&this.loadMore({start:1,end:50,batchId:this.itemModels.length>0?this.itemModels[this.itemModels.length-1].id:void 0}).then(function(t){var o=[];t.items.length>0&&(o=e.helper.generateListsFromItems(t.items)),e.appendNewItemLists(o)})},toggleLoadTopButton:function(e){this.loadTopButtonNode.toggleClass("hidden",!e)},handleLoadLatestClick:function(){var t=this;if(!this.isLoadingMore)return this.clearFeedListModel(),this.toggleListLoader("top",!0),e.Analytics.sendClick("Feed Load More Continuated: Top","Feed Load More Continuated"),this.loadMore({id:this.nsid,end:20}).then(function(e){var o=e.items;return t.isAtTop=e.beforeCount<=0,o}).then(function(o){var i=[];return t.toggleListLoader("top",!1),0===o.length?(t.showLoadError(!0,t.helper.getEmptyStateMessage(t.filterType,t.viewerModel)),e.Promise.resolve(o)):(i=t.helper.generateListsFromItems(o),t.relayoutItems(i).then(function(){return t.isAtTop?t.toggleLoadTopButton(!1):t.toggleLoadTopButton(!0),o}))}).catch(function(e){t.toggleListLoader("top",!1)})},handleLoadTopClick:function(){var t=this;if(!this.isLoadingMore){var o=this.feedItemLists[0].items[0];e.one('[data-batch-id="'+o.batchId+'"]');this.loadMoreBefore().then(function(o){var i=[];return t.isAtTop=o.beforeCount<=0,o.items?(o.items.length>0&&(i=t.helper.generateListsFromItems(o.items)),t.appendNewItemLists(i,!0).then(function(){return o.items})):e.Promise.resolve()}).then(function(o){t.isAtTop?t.toggleLoadTopButton(!1):t.toggleLoadTopButton(!0),o.length>0&&setTimeout(function(){e.AnchorRepositioner.jumpTo(t.itemNodes[o[o.length-1].id],0)},0)})}},loadContinuated:function(t){return e.ListFetchers["flickr-feed-getFeed"].run(Object.assign({perBatch:this.helper.PER_BATCH,eventTypes:this.helper.getEventTypes(this.filterType),relationshipFilter:"friends_and_family"===this.filterType?4:null},t),this.appContext).catch(function(e){throw o.error("Error loading more feed items",{err:e}),e})},getTopItemInView:function(){var e=this;return Object.values(e.feedItems).find(function(t){var o=t.batchId?e.itemNodes[t.id]:void 0,i=o?o.getDOMNode().getBoundingClientRect():void 0;if(i&&i.height>0&&i.top>=0&&i.top<=window.innerHeight)return!0})},handleLayoutClick:function(e){e.target.ancestor('[data-layout-type="compact"]',!0)?this.changeLayout("compact",!0):e.target.ancestor('[data-layout-type="medium"]',!0)?this.changeLayout("medium",!0):e.target.ancestor('[data-layout-type="large"]',!0)&&this.changeLayout("large",!0)},changeLayout:function(t,i){var n=this,a={};this.layoutType=t,this.layoutValues=this.helper.layoutValues[this.layoutType],e.Analytics.setDataLayerProp("feed.layoutType",this.layoutType),i&&(a.feed_layout_type=this.layoutType,this.appContext.callAPI("flickr.prefs.setPrefs",a).then(function(){n.savedLayoutType=n.layoutType,e.Analytics.sendClick("Feed Layout Type: "+n.layoutType,"Feed Layout Type Changed")},function(e){o.error("Error changing user prefs",{err:e})})),this.setLayoutTabSelected(t),this.relayoutItems()},relayoutItems:function(t){var o=t||this.feedItemLists.slice(0);if(!this.isInitiallyLoaded||this.isLoadErrorState)return e.Promise.reject();this.feedColumnContentNode.setHTML(""),this.widowedItems=[],this.batchJustifiedLayouts={},this.itemBoxes={},this.itemNodes={},this.cardViews={},this.feedItemLists=[];for(var i in this.cardViews)i in this.cardViews&&this.cardViews[i].destroy();return this.appendNewItemLists(o)},setLayoutTabSelected:function(e){this.get("container").one(".layout-tabs").all(".tab").each(function(t){t.toggleClass("selected",t.getAttribute("data-layout-type")===e)})},hideDummyLoader:function(){var e=this;this.dummyLoaderNode.addClass("fading"),setTimeout(function(){e.dummyLoaderNode.remove()},500)},toggleListLoader:function(e,t){"bottom"===e?this.bottomLoader.toggleClass("hidden",!t):"top"===e&&this.topLoader.toggleClass("hidden",!t)},handleFilterClick:function(t){var i=this,n={},a=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,preferBottom:!0,anchorElement:this.filterMenuNode.one(".arrow"),keyboardAnchorElement:this.filterMenuNode,closeOnScroll:!0,menuItems:[{text:this.intlMessage(this.FILTER_TYPE_INTL.all),value:"all",isSelected:"all"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.people),value:"people",isSelected:"people"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.groups),value:"groups",isSelected:"groups"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.friends_and_family),value:"friends_and_family",isSelected:"friends_and_family"===this.filterType}]});a.show(),this.registerEventHandler(a.on("selected",function(t){t&&t.menuItem&&(i.filterMenuNode.one(".filter-menu-text").set("text",i.intlMessage(i.FILTER_TYPE_INTL[t.menuItem.value])),n.feed_filter_type=t.menuItem.value,i.layoutType=t.menuItem.value,i.appContext.callAPI("flickr.prefs.setPrefs",n).then(function(o){e.Analytics.sendClick("Feed Filter Type: "+t.menuItem.value,"Feed Filter Type Changed"),i.appContext.flapp.navigate(e.config.win.location.href)},function(e){o.error("Error setting feed user prefs",{err:e})})),a.close()}),this)},handlePageResize:function(){var e=this,t=this.appContext.viewportData.getWidth()<=700,o=this.feedColumnContentNode.get("clientWidth");if(o!==this.currentFeedColumnWidth){if(this.currentFeedColumnWidth=o,this.isMobileViewport===t)return this.isResizing||(this.resizeScrollTop=this.scrollContainer.get("scrollTop"),this.isResizing=!0),this.relayoutItems().then(function(){setTimeout(function(){e.resizeScrollTop&&e.scrollContainer.set("scrollTop",e.resizeScrollTop),e.isResizing=!1},50)});t?this.changeLayout("large",!1):this.changeLayout(this.savedLayoutType,!1),this.isMobileViewport=t}},destructor:function(){e.one("body").setStyle("overflow","initial")},showBatchOverlay:function(t){var o=this;return("batchPeople"===t.layoutType?this.appContext.getView("feed-people-batch-view",{feedItem:Object.values(o.feedItems).find(function(e){return e.id===t.itemId}),feedHelper:this.helper,layoutType:t.layoutType,headerText:this.intlMessage({intlName:"feed.PEOPLE_TO_FOLLOW"})}):this.appContext.getView("feed-batch-view",{feedItem:Object.values(o.feedItems).find(function(e){return e.id===t.itemId}),feedHelper:this.helper,layoutType:t.layoutType})).then(function(e){return e.initialize()}).then(function(t){o.batchOverlayId=o.appContext.overlayManager.push({view:t,disableBodyScroll:!0,dismissOnEsc:!0}),o.appContext.overlayManager.placeViewAfterOverlay(o.batchOverlayId),setTimeout(function(){t.get("container").addClass("active")},0),e.Analytics.setDataLayerProp("feed.isInsideOverlay",!0),o.registerEventHandler(t.on("close",function(){o.appContext.overlayManager.pop(o.batchOverlayId),e.Analytics.setDataLayerProp("feed.isInsideOverlay",!1),e.Analytics.sendClick("Feed Batch Overlay Closed")})),t.normalizedActivate()})},showLoadError:function(e,t){t&&this.loadErrorContainerNode.set("innerHTML",t),this.loadErrorContainerNode.toggleClass("hidden",!e),this.isLoadErrorState=e},toggleFadeGroupCards:function(e,t){var o=this;Object.values(this.feedItems).forEach(function(i){var n=o.cardViews[i.id];n&&i.groupId===e&&(i.isFaded=t,n.toggleFaded(t))})},clearFeedListModel:function(){this.feedListModel.setValue("feedList",[]),this.feedListModel.setValue("beforeCount",Number.MAX_VALUE),this.feedListModel.setValue("afterCount",Number.MAX_VALUE)},updateStoredFeedListChunk:function(e,t,o){var i,n,a,r=this.feedListModel.getValue("feedList"),s=r.length,l=0;r.find(function(t,o){if(t.getValue("id")===e)return l=o,!0}),i=Math.max(l-t,0),n=Math.min(l+o,r.length),a=r.slice(i,n),this.feedListModel.setValue("feedList",a),this.feedListModel.setValue("beforeCount",this.feedListModel.getValue("beforeCount")+i),this.feedListModel.setValue("afterCount",this.feedListModel.getValue("afterCount")+(s-n))}})},"@VERSION@",{requires:["flickr-view","photo-card-view","people-card-view","feed-rail-view","hermes-template-feed-new-page","hermes-template-head-meta","hermes-template-adult-content-photo-overlay","hermes-template-ad-card","flickr-feed-getFeed-fetcher","feed-helper","photo-card-helper","storage-helper","url-helper","subscriptions-helper"],
langBundles:["common","blurb","fave-view","share-modal","comments","relative-dates","feed","adult-content-overlay"]});YUI.add("search-helper",function(e){function t(e,t){var a;for(a in l){if(!t&&a===e)return l[a];if(t&&l[a]===e)return a}}var a=require("hermes-core/type-validator"),s=["q","ss","ct","mt","l","s","w","d","m","hd","b","a","g","e","cm","xel","xeh","xal","xah","xfl","xfh","eui"],r={userId:"user_id",groupId:"group_id",groupPathAlias:"group_path_alias",setId:"set_id",page:"page",text:"text",tags:"tags",tagMode:"tag_mode",sort:"sort",safeSearch:"safe_search",contentType:"content_type",mediaType:"media",license:"license",faves:"faves",contacts:"contacts",getty:"is_getty",commons:"is_commons",marketplace:"marketplace_licensable",minTakenDate:"min_taken_date",maxTakenDate:"max_taken_date",minUploadDate:"min_upload_date",maxUploadDate:"max_upload_date",hasGeo:"has_geo",boundingBox:"bbox",accuracy:"accuracy",woeId:"woe_id",camera:"camera",minExposure:"exif_min_exposure",maxExposure:"exif_max_exposure",minAperture:"exif_min_aperture",maxAperture:"exif_max_aperture",minFocalLength:"exif_min_focallen",maxFocalLength:"exif_max_focallen",excludeUserId:"exclude_user_id",foursquareWoeId:"foursquare_woeid",foursquareVenueId:"foursquare_venueid",slideshowStartId:"jump_to",height:"height",width:"width",dimensionSearchMode:"dimension_search_mode",orientation:"orientation",colorCodes:"color_codes",styles:"styles",similarityId:"similarity_id"},n={relevant:"relevance",recent:"date-posted-desc",interesting:"interestingness-desc",name:"exact-name-match-first",activity:"most-activity",size:"most-members",oldest:"oldest-first",newest:"recent-first",oldestJoined:"age",mostPhotos:"pho",dateUploaded:"date-posted-desc",dateTaken:"date-taken-desc"},o=["s","q","see","m"],i={username:"username",userId:"user_id",sort:"sort"},c=["q","s","m"],d={text:"text",sort:"sort",safeSearch:"safe_search",userId:"user_id",subscriptionTypes:"subscription_types",filterInactive:"filter_inactive_groups"},l={all:"0,1,2,3,4,5,6,7,8,9,10",cc:"1,2,3,4,5,6,9",deriv:"1,2,4,5,9,10",comm:"4,5,6,9,10",commderiv:"4,5,9,10"},u=[r.tags,r.tagMode,r.mediaType,r.minTakenDate,r.maxTakenDate,r.minUploadDate,r.maxUploadDate,r.height,r.width,r.dimensionSearchMode,r.orientation,r.marketplace,r.excludeUserId],m=[r.colorCodes,r.styles],p=[r.sort,r.safeSearch,r.license],h=[r.userId,r.groupId,r.faves,r.contacts,r.commons,"m","w"],f=[r.userId,r.groupId,r.faves,r.contacts,r.safeSearch,r.sort,r.license,r.tags,r.text],g={sort:n.relevant,parse_tags:"1",content_type:"7"};e.SearchHelper={API:r,PEOPLE_SEARCH_API:i,GROUPS_SEARCH_API:d,GROUPS_SAFE_SEARCH_SETTINGS:{safe:1,all:2,eighteenPlusOnly:3},API_SORT_OPTIONS:n,API_ORIENTATION_OPTIONS:{portrait:"portrait",square:"square",landscape:"landscape",panorama:"panorama"},LICENSE_TYPE:l,UNIFIED_STATE_PARAMS:{viewAll:"view_all",viewType:"view_type",advanced:"advanced",albums:"album_search"},UNIFIED_ADVANCED_PARAMS:u,UNIFIED_QUICK_FILTER_PARAMS:m,UNIFIED_TOOLBAR_PARAMS:p,SEARCH_SCOPE_PARAMS:h,UNIFIED_DEFAULT_PARAMS:g,decodeContentType:function(e){var t={};switch(parseInt(e,10)){case 1:t.photos=!0;break;case 2:t.screenshots=!0;break;case 3:t.other=!0;break;case 4:t.photos=!0,t.screenshots=!0;break;case 5:t.other=!0,t.screenshots=!0;break;case 6:t.photos=!0,t.other=!0;break;default:t.photos=!0,t.screenshots=!0,t.other=!0}return t},encodeContentType:function(e){var t=0;return!e.photos||e.screenshots||e.other?e.photos||!e.screenshots||e.other?e.photos||e.screenshots||!e.other?e.photos&&e.screenshots&&!e.other?t=4:!e.photos&&e.screenshots&&e.other?t=5:e.photos&&!e.screenshots&&e.other?t=6:e.photos&&e.screenshots&&e.other&&(t=7):t=3:t=2:t=1,t},isParameterlessSearch:function(e){return!(e[r.userId]||e[r.groupId]||e[r.tags]||e[r.text]||e[r.license]||e[r.faves]||e[r.contacts]||e[r.getty]||e[r.commons]||e[r.minTakenDate]||e[r.maxTakenDate]||e[r.minUploadDate]||e[r.maxUploadDate]||e[r.hasGeo]||e[r.boundingBox]||e[r.woeId]||e[r.camera]||e[r.minExposure]||e[r.maxExposure]||e[r.minAperture]||e[r.maxAperture]||e[r.minFocalLength]||e[r.maxFocalLength]||e[r.foursquareWoeId]||e[r.foursquareVenueId]||e[i.username]||e[r.similarityId])},mapRouteParamsToAPI:function(e){var t,s={nsid_or_path_alias:"userId",group_id:"groupId",set_id:"setId",page_number:"page",tag_list:"tags",location:"text",slideshow_start_id:"slideshowStartId"},n={};for(t in s)e[t]&&(n[r[s[t]]]=e[t]);return n[r.groupId]&&!a.nsid(n[r.groupId])&&(n[r.groupPathAlias]=n[r.groupId],delete n[r.groupId]),n},convertLicenseTypeValue:t,mapClassicSearchToAPI:function(t,o){if(!t)return{};var i,c,d,u,m={},p=o.getViewer(),h=t.l,f=t.s,g=t.w,_=t.m,I=t.q;if(t.d&&"string"==typeof t.d&&(d=t.d.split("-")),t.q&&(m[r.text]=t.q),void 0!==t.ss&&(m[r.safeSearch]=parseInt(t.ss,10)+1),void 0!==t.ct&&(m[r.contentType]=parseInt(t.ct,10)+1),void 0!==t.mt&&(m[r.mediaType]=t.mt),t.b&&(m[r.boundingBox]=t.b),t.a&&(m[r.accuracy]=t.a),t.e&&(m[r.woeId]=t.e),t.g&&(m[r.groupId]=t.g),t.cm&&(m[r.camera]=t.cm),void 0!==t.xel&&(m[r.minExposure]=t.xel),void 0!==t.xeh&&(m[r.maxExposure]=t.xeh),void 0!==t.xal&&(m[r.minAperture]=t.xal),void 0!==t.xah&&(m[r.maxAperture]=t.xah),void 0!==t.xfl&&(m[r.minFocalLength]=t.xfl),void 0!==t.xfh&&(m[r.maxFocalLength]=t.xfh),t.eui&&(m[r.excludeUserId]=t.eui),void 0!==h)switch(h){case"cc":case"comm":case"deriv":case"commderiv":m[r.license]=l[h];break;default:(c=parseInt(h,10))>=0&&c<=10&&(m[r.license]=c)}if(f)switch(f){case"rec":m[r.sort]=n.recent;break;case"rel":m[r.sort]=n.relevant;break;case"int":m[r.sort]=n.interesting}if(t.hd&&(m[r.media]="hdvideo"),g&&"string"==typeof g)if(-1!==g.indexOf("faves"))u=g.split("-"),m[r.faves]=1,u.length>1?m[r.userId]=u[1]:p.signedIn&&(m[r.userId]=p.nsid);else if(a.nsid(g))"pool"===_?m[r.groupId]=g:m[r.userId]=g;else switch(g){case"contacts":m[r.contacts]="all";break;case"ff":m[r.contacts]="ff";break;case"getty":m[r.getty]="true";break;case"commons":m[r.commons]="true";break;case"usg":m[r.license]=8}if(d)switch(d[0]){case"taken":d[1]&&(m[r.minTakenDate]=e.flutil.parseYYYYMMDDDatestamp(d[1])/1e3),d[2]&&(m[r.maxTakenDate]=e.flutil.parseYYYYMMDDDatestamp(d[2])/1e3);break;case"posted":d[1]&&(m[r.minUploadDate]=e.flutil.parseYYYYMMDDDatestamp(d[1])/1e3),d[2]&&(m[r.maxUploadDate]=e.flutil.parseYYYYMMDDDatestamp(d[2])/1e3)}if(_&&I)switch(_){case"tags":delete(m=e.merge(m,this.processTags(I)))[r.text]}for(i in t)-1===s.indexOf(i)&&(m[i]=t[i]);return m},mapClassicPeopleSearchToAPI:function(e,t){var a={},s=null,r=t.getViewer();if((e=e||{}).q&&(a[i.username]=e.q),e.s)switch(e.s){case"age":a[i.sort]=n.oldestJoined;break;case"pho":a[i.sort]=n.mostPhotos}e.see&&"all"===e.see.toString().toLowerCase()&&r.signedIn&&(a[i.userId]=r.nsid),e.m&&(e.m.toString().toLowerCase(),e.m.toString().toLowerCase());for(s in e)-1===o.indexOf(s)&&(a[s]=e[s]);return a},mapClassicGroupSearchToApi:function(e,t){var a,s={},r=null;if(e=e||{},a=e.m&&"discuss"===e.m.toString().toLowerCase(),e.q&&(s[d.text]=e.q),e.s)switch(e.s){case"act":s[d.sort]=a?n.discussionActivity:n.activity;break;case"siz":s[d.sort]=n.size;break;case"age":s[d.sort]=n.newest}for(r in e)-1===c.indexOf(r)&&(s[r]=e[r]);return s},mapAPIParamsToAdvancedSearchQuery:function(e){var a={},s=e[r.userId];return e[r.text]?a.q=e[r.text]:e[r.tags]&&(a.q=e[r.tags]),e[r.faves]?a.w=s?"faves-"+s:"faves":s?a.w=s:"all"===e[r.contacts]?a.w="contacts":"ff"===e[r.contacts]?a.w="ff":"true"===e[r.getty]?a.w="getty":"true"===e[r.commons]?a.w="commons":8===parseInt(e[r.license],10)&&(a.w="usg"),e[r.license]&&(a.l=t(e[r.license],!0)),a},deriveScopeTitle:function(t,s){var n,o=s.getViewer();return t[r.userId]?o&&o.signedIn&&o.nsid===t[r.userId]?t[r.faves]?e.Promise.resolve({intlName:"search.VIEWER_FAVES"}):e.Promise.resolve({intlName:"search.YOUR_PHOTOS"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){var a;return a=t[r.faves]?"search.FAVES_POSSESSIVE":"search.PHOTOS_POSSESSIVE",{intlName:a,name:e.getValue("displayname")}})):t[r.contacts]?e.Promise.resolve({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"}):t[r.groupId]||t[r.groupPathAlias]?(n=t[r.groupId]?{id:t[r.groupId]}:{pathAlias:t[r.groupPathAlias]},s.getModel("group-info-models",n).then(function(e){return{intlName:"search.IN_GROUP_POOL",name:e.getValue("group").getValue("title")}})):t[r.faves]?e.Promise.resolve({intlName:"search.VIEWER_FAVES"}):e.Promise.resolve({intlName:"search.EVERYONES_PHOTOS"})},derivePeopleScopeTitle:function(t,s){var n,o=s.getViewer();if(t[r.userId])return o&&o.signedIn&&o.nsid===t[r.userId]?e.Promise.resolve({intlName:"search.PEOPLE_YOU_FOLLOW"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){return{intlName:"search.CONTACTS_POSSESSIVE",name:e.getValue("username")}}))},deriveGroupsScopeTitle:function(t,s){var n,o=s.getViewer();if(t[r.userId])return o&&o.signedIn&&o.nsid===t[r.userId]?e.Promise.resolve({intlName:"search.YOUR_GROUPS"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){return{intlName:"search.GROUPS_POSSESSIVE",name:e.getValue("username")}}))},deriveCCLicenseString:function(e){e||(e={});var t=null,a=e[r.license];if(a&&1===a.length)switch(parseInt(a,10)){case 1:t="search.CC_BY_NC_SA";break;case 2:t="search.CC_BY_NC";break;case 3:t="search.CC_BY_NC_ND";break;case 4:t="search.CC_BY";break;case 5:t="search.CC_BY_SA";break;case 6:t="search.CC_BY_ND"}return t?{intlName:t}:null},addParamDefaults:function(e,t){!e[r.license]||e[r.license]!==l.all&&""!==e[r.license]||delete e[r.license]},addGroupsParamDefaults:function(e){},addPeopleParamDefaults:function(e){},clearParams:function(e,t){for(var a in e)-1===t.indexOf(a)&&delete e[a]},clearAdvancedSearchParams:function(e){this.clearParams(e,f)},clearParamsExceptSearchScope:function(e){this.clearParams(e,h)},generateQueryString:function(t){var a=e.clone(t)||{};return delete a.page,delete a.method,delete a.extras,e.QueryString.stringify(a)},convertSafeSearchPrefsToApi:function(t){var a=e.AttributeHelpers.coerceInteger(t);return e.AttributeHelpers.coerceString(a+1)},unescapeParameters:function(t){var a=t[r.groupId],s=t[r.tags],n=t[r.text];YUI.Env.isServer&&(a&&(t[r.groupId]=e.flutil.unescape(a)),s&&(t[r.tags]=e.flutil.unescape(s)),n&&(t[r.text]=e.flutil.unescape(n)))},objectsAreEquivalentToDepth:function(t,a,s){var r,n,o=this;return t===a||!(s<=0)&&(s=s||1,!(!e.Lang.isObject(t)||!e.Lang.isObject(a))&&(r=Object.keys(t),n=Object.keys(a),r.length===n.length&&r.every(function(e){return o.objectsAreEquivalentToDepth(t[e],a[e],s-1)})))},normalizeTag:function(e){var t;return e&&(t=e.replace(/[\s!-\/:-@[-`]/g,"")),t},processTags:function(e,t){if(!e||"string"!=typeof e)return{};var a,s,n,o,i={},c=/(["'])(\\?.)*?\1/g,d=/^([,\+]|AND|OR)$/;return a=e.match(c)||[],s=e.replace(c,""),n=s.split(/[,\+\s]/),n=n.map(function(e){return e.trim()}).filter(function(e){return e&&!d.test(e)}),o=a.concat(n),i[r.tags]=o.join(","),"any"===t||"all"===t?i[r.tagMode]=t:/[\+\s]OR[\+\s]/.test(e)?(i[r.tagMode]="any",o.length=Math.min(o.length,11)):i[r.tagMode]="all",i}}},"@VERSION@",{requires:["flutil"]});YUI.add("notification-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{id:{},isSeen:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isMuted:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},type:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},timestamp:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},activityData:{},eventDataList:[],userModels:[],activityEntityModels:{},eventEntityModelsList:[]}})},"@VERSION@",{requires:["flickr-model-registry"]});YUI.add("contact-models",function(e){"use strict";function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},iconfarm:{},iconserver:{},buddyicon:{},nsid:{readOnly:!0,defaultFn:function(e){return e}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}},isPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{defaultValue:"standard",setter:function(t){return e.AttributeHelpers.coerceString(t)}},profileURL:{readOnly:!0,derivedBy:["pathAlias","nsid"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return t||(t=e),"/photos/"+t}},followsURL:{readOnly:!0,derivedBy:["pathAlias","nsid"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return t||(t=e),"/people/"+t+"/contacts"}}}})},"@VERSION@",{requires:["flickr-model-registry","attribute-helpers","url-helper"]});YUI.add("flickr-notifications-markread-updater",function(r,i){"use strict";r.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:function(e,a){return a.callAPI("flickr.notifications.markread",e).then(null,r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-getNotificationsCount-fetcher",function(t,i){"use strict";t.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:function(e,o){var n=this,s=this._processParams(e);return t.FlickrPromise({apiResponse:o.callAPI("flickr.activity.getNotificationsCount",s),personNotifsModelRegistry:o.getModelRegistry("person-notifications-models")}).then(function(t){return n._processResponse(t,o,s)},t.FetcherErrorLogger(i))},_processParams:function(i){var e=i.notification_groups||"default,hermes_2020,groups_you_admin,bot_moderation";return t.merge(i,{notification_groups:e})},_processResponse:function(t,i,e){var o=t.apiResponse,n=t.personNotifsModelRegistry,s=n.getValue(e.id,"unseenNotificationCounts")||{};return n.setValue(e.id,"unseenNotificationCount",o.activity.count),n.setValue(e.id,"unseenNotificationCounts",Object.assign(s,o.activity)),o.activity.count}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});