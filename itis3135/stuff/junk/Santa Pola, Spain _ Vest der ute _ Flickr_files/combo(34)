YUI.add("flickr-interestingness-getList-fetcher",function(e,t){var o=100;e.namespace("ListFetchers")["flickr-interestingness-getList"]={run:function(o,r){var s,p=this,i=this._processParams(o,r);return s=[r.callAPI("flickr.interestingness.getList",i),r.getModelRegistry("explore-models"),r.getModelRegistry("photo-lite-models")],e.Promise.all(s).then(function(e){return p._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t,r){var s;return s={extras:e.APIHelper.request.getRebootPhotoLiteExtras(),per_page:t.perPage||o,page:t.page||"1",date:t.id},r.flipper.isFlipped("enable-explore-v2-api")&&(s.version="v2"),e.merge(s,t.apiParams||{})},_processResponse:function(t,o){var r,s=t[0],p=t[1],i=t[2],a={id:o.id},n=[];if(!o.id)throw new ReferenceError("No `id` provided by request.");if(!s.photos||!s.photos.photo)throw new Error("No `photos.photo` property returned by API.");return n=s.photos.photo.map(function(t){return r=e.APIHelper.response.parsePhotoLite(t),i.addOrUpdate(r)}),a.photos={perPage:s.photos.perpage,page:s.photos.page||1,pageContent:n,totalItems:s.photos.total,totalPages:s.photos.pages},a.totalItems=s.photos.total,p.addOrUpdate(a),a.photos.pageContent}}},"@VERSION@",{requires:["api-helper","flickr-promise"],optional:["explore-models","photo-lite-models"]});YUI.add("explore-rail-card-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("explore-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.justifiedLayout=require("justified-layout"),this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.photoItems=t.photoItems||[]},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("explore-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Explore","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.photoItems&&this.photoItems.length>0?e.Promise.resolve():this.loadExplore()).then(function(){return t.buildLayout()}).then(function(){t.dummyLoaderNode.addClass("hidden")})},buildLayout:function(){var t,i=this,o=e.Node.create('<div class="explore-layout"></div>'),n=[],r=i.photoItems.map(function(e){return Math.min(e.aspectRatio,2)}),a=0,s=0,l=0;return(t=i.justifiedLayout(r,{containerWidth:this.listContainerNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:4,vertical:4},targetRowHeight:70,targetRowHeightTolerance:.2})).boxes.some(function(e,i){s<e.top&&(s=e.top,++a>=2&&(l=l||i,t.containerHeight=t.containerHeight-e.height-4))}),l||(l=t.boxes.length),t.boxes=t.boxes.slice(0,l),this.listContainerNode.appendChild(o),o.setStyle("position","relative"),o.setStyle("height",t.containerHeight),t.boxes.forEach(function(e,t){var o=i.photoItems[t];n.push(i.appContext.getView("photo-card-view",{box:e,isAwakeInitially:!0,photoConfig:{photoItem:o,box:e,urlContext:"/in/explore",showPhotoInterstitial:o.needsInterstitial,photoInterstitialContent:o.needsInterstitial?i.templates("adult-content-photo-overlay")({isCompact:!0,photoUrl:o.url+"/in/explore"}):void 0}}).then(function(e){return e.initialize()}))}),e.Promise.all(n).then(function(i){return i.forEach(function(i,n){var r=i.params.photoConfig.photoItem,a=t.boxes[n],s=i.get("container"),l=e.Node.create('<div class="explore-photo-item" data-item-id="'+r.id+'"></div>');l.setStyle("position","absolute"),l.setStyle("display","flex"),l.setStyle("flex-direction","column"),l.setStyle("top",a.top),l.setStyle("left",a.left),l.appendChild(s),o.appendChild(l),i.activate()}),o})},loadExplore:function(){var t=this,i=e.moment.utc().subtract({days:1,hours:4}),o=[i.format("YYYY"),i.format("MM"),i.format("DD")].join("-"),n={id:o,apiParams:{date:o,page:1,per_page:15}};return this.appContext.getModel("explore-models",n).then(function(e){t.exploreModel=e,t.photoItems=e.getValue("photos").getList().map(function(e){return t.photoCardHelper.convertPhotoModel(e)})})},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})},"@VERSION@",{requires:["flickr-view","photo-card-view","hermes-template-explore-rail-card","hermes-template-adult-content-photo-overlay","explore-models"],langBundles:["common","adult-content-overlay","feed"]});YUI.add("hermes-template-blog-rail-card",function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,i,l){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="blog-rail-card">\n\t<h2 class="title">\n\t\t'+e.escapeExpression((n(a,"intlMessage")||t&&n(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.FLICKR_BLOG"},data:l,loc:{start:{line:3,column:2},end:{line:3,column:45}}}))+'\n\t</h2>\n\n\t<div class="blog-rail-content-container hidden">\n\t\t\n\t</div>\n\t<div class="dummy-loader">\n\t\t<div class="box" style="height: 140px; width: 100%"></div>\n\t\t<div class="box" style="height: 14px; width: 100%"></div>\n\t\t<div class="box" style="height: 80px; width: 100%"></div>\n\t\t<div class="box" style="height: 14px; width: 80%"></div>\n\t</div>\n</div>\n'},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/blog-rail-card",function(t,l){return l=l||{},l.partials=l.partials?e.merge(i,l.partials):i,a(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-blog-rail-content",function(l,n){var t=l.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(l,n,t,e,a){var i,o,r=null!=n?n:l.nullContext||{},s=l.hooks.helperMissing,c="function",u=l.escapeExpression,p=l.lambda,d=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<div class="blog-rail-content">\n\t<a class="blog-photo" href="'+u(typeof(o=null!=(o=d(t,"link")||(null!=n?d(n,"link"):n))?o:s)===c?o.call(r,{name:"link",hash:{},data:a,loc:{start:{line:2,column:29},end:{line:2,column:37}}}):o)+'" target="_blank"\n\t\tstyle="background-image: url(\''+u(p(null!=(i=null!=n?d(n,"photo"):n)?d(i,"displayUrl"):i,n))+"'); width: "+u(p(null!=(i=null!=n?d(n,"photo"):n)?d(i,"width"):i,n))+"px; height: "+u(p(null!=(i=null!=n?d(n,"photo"):n)?d(i,"height"):i,n))+'px;"\n\t\tdata-link-id="blog_rail_photo_link">\n\t</a>\n\t<a class="blog-title" href="'+u(typeof(o=null!=(o=d(t,"link")||(null!=n?d(n,"link"):n))?o:s)===c?o.call(r,{name:"link",hash:{},data:a,loc:{start:{line:6,column:29},end:{line:6,column:37}}}):o)+'" target="_blank" data-link-id="blog_rail_title_link">\n\t\t'+u(typeof(o=null!=(o=d(t,"title")||(null!=n?d(n,"title"):n))?o:s)===c?o.call(r,{name:"title",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:11}}}):o)+'\n\t</a>\n\t<p class="blog-description">\n\t\t'+u(typeof(o=null!=(o=d(t,"description")||(null!=n?d(n,"description"):n))?o:s)===c?o.call(r,{name:"description",hash:{},data:a,loc:{start:{line:10,column:2},end:{line:10,column:17}}}):o)+'\n\t</p>\n\t<a class="learn-more-link" href="'+u(typeof(o=null!=(o=d(t,"link")||(null!=n?d(n,"link"):n))?o:s)===c?o.call(r,{name:"link",hash:{},data:a,loc:{start:{line:12,column:34},end:{line:12,column:42}}}):o)+'" target="_blank" data-link-id="blog_rail_more_link">'+u((d(t,"intlMessage")||n&&d(n,"intlMessage")||s).call(r,{name:"intlMessage",hash:{intlName:"feed.READ_MORE"},data:a,loc:{start:{line:12,column:95},end:{line:12,column:136}}}))+"</a>\n</div>"},useData:!0}),e={};l.Array.each([],function(n){var t=l.Template.get("hermes/"+n);t&&(e[n]=t)}),l.Template.register("hermes/blog-rail-content",function(n,a){return a=a||{},a.partials=a.partials?l.merge(e,a.partials):e,t(n,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-feed-getLatestFlickrBlog-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-feed-getLatestFlickrBlog"]={run:function(o,r){var i=this;return e.FlickrPromise({apiResponse:r.callAPI("flickr.feed.getLatestFlickrBlog",this._processParams(o),!0),blogModelRegistry:r.getModelRegistry("blog-models")}).then(function(e){return i._processResponse(e,o)},function(e){throw e}).then(null,e.FetcherErrorLogger(t))},_processParams:function(e){return{}},_processResponse:function(t,o){var r=t.apiResponse,i=t.blogModelRegistry,s={};return s={id:"latest",blogId:r.guid,title:r.title,date:r.date,link:r.link,description:r.description,photoId:r.photoId,photoData:{id:r.photo.id,title:r.photo.title,description:r.photo.description,sizes:e.APIHelper.response.parsePhotoSize(r.photo.sizes.size,!0)}},i.addOrUpdate(s)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models"]});YUI.add("blog-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-feed-getLatestFlickrBlog"].run(t,this.appContext)}},attributes:{id:{},blogId:{},title:{},date:{},link:{},description:{},photoId:{},photoData:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-feed-getLatestFlickrBlog-fetcher"]});YUI.add("blog-rail-card-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("blog-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.blogItem=t.blogItem,this.photoSizeHelper=new e.PhotoSizeHelper(this.appContext),this.viewCounter=this.appContext.getViewCounter()},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("blog-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Blog","Rail Card Loaded"),this.dummyLoaderNode=i.one(".dummy-loader"),this.blogContainerNode=i.one(".blog-rail-content-container"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.blogItem?e.Promise.resolve():this.loadBlog()).then(function(){t.buildLayout()}).then(function(){t.viewCounter.queue(t.blogItem.photoData.id,document.location.href),t.dummyLoaderNode.addClass("hidden")})},buildLayout:function(){this.blogItem;var e,t,i,o={title:this.blogItem.title,description:this.blogItem.description,link:this.blogItem.link},n=this.blogItem.photoData.sizes,r=this.photoSizeHelper.getPhotoAspectRatio(n);this.blogContainerNode.removeClass("hidden"),t=this.blogContainerNode.get("clientWidth"),i=this.photoSizeHelper.getSizeToFit(n,{width:t,height:t/r},{includeSquare:!1}),o.photo={displayUrl:i.displayUrl,width:t,height:t/r},e=this.templates("blog-rail-content")(o),this.blogContainerNode.set("innerHTML",e)},loadBlog:function(){var e=this;return this.appContext.getModel("blog-models","latest").then(function(t){e.blogItem=t.toJSON()})},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})},"@VERSION@",{requires:["flickr-view","hermes-template-blog-rail-card","hermes-template-blog-rail-content","blog-models","photo-size-helper"],langBundles:["common","feed"]});